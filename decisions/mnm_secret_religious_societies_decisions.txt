###########################################
#
# Society decisions for secret religious societies
#
###########################################

society_decisions = {
	
	secret_religions_openly_adopt_faith = {
		is_high_prio = yes
		
		potential = {
			society_member_of = secret_religious_cult

			society_rank == 4
		}
	
		allow = {
			OR = {
				has_society_currency_major_trigger = yes
				hidden_tooltip = {
					ai = yes
				}
			}
			prisoner = no
			NOT = { trait = incapable }
			NOT = { is_inaccessible_trigger = yes }
			war = no
		}
		
		effect = {
#			hidden_effect = { # To track the number of Revealed Cults
#				change_variable = { which = global_revealed_cults value = 1 }
#				if = {
#					limit = {
#						secret_religion = antinomian
#					}
#					change_variable = { which = global_antinomian_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = aten
#						}
#						change_variable = { which = global_aten_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = batembuzi
#						}
#						change_variable = { which = global_batembuzi_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = bud_bahusrutiya
#						}
#						change_variable = { which = global_bud_bahusrutiya_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = bud_mahayana
#						}
#						change_variable = { which = global_bud_mahayana_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = cathar
#						}
#						change_variable = { which = global_cathar_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = dionysos
#						}
#						change_variable = { which = global_dionysos_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = donatist
#						}
#						change_variable = { which = global_donatist_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = druze
#						}
#						change_variable = { which = global_druze_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = erlik
#						}
#						change_variable = { which = global_erlik_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = haruri
#						}
#						change_variable = { which = global_haruri_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = hubal
#						}
#						change_variable = { which = global_hubal_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = hurufi
#						}
#						change_variable = { which = global_hurufi_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = ibadi
#						}
#						change_variable = { which = global_ibadi_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = iconoclast
#						}
#						change_variable = { which = global_iconoclast_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = illuyanka
#						}
#						change_variable = { which = global_illuyanka_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = irminsul
#						}
#						change_variable = { which = global_irminsul_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = jud_sabaoth
#						}
#						change_variable = { which = global_jud_sabaoth_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = kharijite
#						}
#						change_variable = { which = global_kharijite_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = mand_ruha
#						}
#						change_variable = { which = global_mand_ruha_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = mani_ahriman
#						}
#						change_variable = { which = global_mani_ahriman_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = mazdakism
#						}
#						change_variable = { which = global_mazdakism_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = melkite
#						}
#						change_variable = { which = global_melkite_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = montanist
#						}
#						change_variable = { which = global_montanist_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = norse_war
#						}
#						change_variable = { which = global_norse_war_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = pelagian
#						}
#						change_variable = { which = global_pelagian_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = plato_christ
#						}
#						change_variable = { which = global_plato_christ_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = plato_islam
#						}
#						change_variable = { which = global_plato_islam_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = priscillian
#						}
#						change_variable = { which = global_priscillian_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = qarmatian
#						}
#						change_variable = { which = global_qarmatian_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = ragnarok
#						}
#						change_variable = { which = global_ragnarok_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = saule
#						}
#						change_variable = { which = global_saule_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = saura
#						}
#						change_variable = { which = global_saura_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = set
#						}
#						change_variable = { which = global_set_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = sol_christ
#						}
#						change_variable = { which = global_sol_christ_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = sufi
#						}
#						change_variable = { which = global_sufi_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = tengri_ahriman
#						}
#						change_variable = { which = global_tengri_ahriman_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = vidharma
#						}
#						change_variable = { which = global_vidharma_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = yahyanism
#						}
#						change_variable = { which = global_yahyanism_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = zor_angra
#						}
#						change_variable = { which = global_zor_angra
#					}
#				}
#			}
			detract_society_currency_major_effect = yes
			custom_tooltip = {
				text = openly_adopt_faith_effect_tooltip
				if = { # Caliphates and Fylkirates are forfeit
					limit = {
						# OR = {
							# religion_group = muslim
							# religion = norse_pagan_reformed
						# }
						any_demesne_title = {
							controls_religion = yes
						}
					}
					any_demesne_title = {
						limit = {
							controls_religion = yes
						}
						destroy_landed_title = THIS
					}
				}
				if = { # Papacies are given to a random new character
					limit = {
						# NOR = {
							# religion_group = muslim
							# religion = norse_pagan_reformed
						# }
						any_demesne_title = {
							controls_religion = yes
						}
					}
					hidden_tooltip = {
						liege = {
							save_event_target_as = liege_target
						}
						create_character = {
							age = 38
							dynasty = random
							religion = ROOT
							culture = ROOT
							random_traits = yes
						}
						new_character = {
							save_event_target_as = new_holder
						}
					}
					any_demesne_title = {
						limit = {
							controls_religion = yes
						}
						grant_title = event_target:new_holder
						holder_scope = {
							any_vassal = {
								set_defacto_liege = event_target:liege_target
							}
						}
					}
					hidden_tooltip = {
						set_defacto_liege = event_target:liege_target
					}
				}
				if = { # Holy Orders/Static Mercs are given to a random new character
					limit = {
						any_demesne_title = {
							OR = {
								holy_order = yes
								mercenary = yes
							}
						}
					}
					hidden_tooltip = {
						liege = {
							save_event_target_as = liege_target
						}
						create_character = {
							age = 38
							dynasty = random
							religion = ROOT
							culture = ROOT
							random_traits = yes
						}
						new_character = {
							save_event_target_as = new_holder
						}
					}
					any_demesne_title = {
						limit = {
							OR = {
								holy_order = yes
								mercenary = yes
							}
						}
						grant_title = event_target:new_holder
						holder_scope = {
							any_vassal = {
								set_defacto_liege = event_target:liege_target
							}
						}
					}
					hidden_tooltip = {
						set_defacto_liege = event_target:liege_target
					}
				}
				hidden_effect = {
					character_event = { id = MNM.3811 }
					any_society_member = {
						if = {
							limit = {
								NOT = {
									character = ROOT
								}
								same_society_as = ROOT
							}
							character_event = { id = MNM.3800 } # Convert cultists
						}
					}
					top_liege = {
						any_realm_character = {
							if = {
								limit = {
									NOT = {
										same_society_as = ROOT
									}
									OR = {
										has_prevs_secret_religion_truly_trigger = yes
										has_sympathy_for_true_religion_of_prev_trigger = yes
									}
								}
								character_event = { id = MNM.3810 } # Allow sympathisers the chance to flip
							}
							
							if = {
								limit = {
									is_ruler = yes
									any_demesne_province = {
										OR = {
											AND = {
												has_province_modifier = secret_antinomian_community
												ROOT = {
													society_member_of = secret_religious_society_antinomian
												}
											}
											
											AND = {
												has_province_modifier = secret_aten_community
												ROOT = {
													society_member_of = secret_religious_society_aten
												}
											}
											
											AND = {
												has_province_modifier = secret_batembuzi_community
												ROOT = {
													society_member_of = secret_religious_society_batembuzi
												}
											}
											
											AND = {
												has_province_modifier = secret_bud_bahusrutiya_community
												ROOT = {
													society_member_of = secret_religious_society_bud_bahusrutiya
												}
											}
											
											AND = {
												has_province_modifier = secret_bud_mahayana_community
												ROOT = {
													society_member_of = secret_religious_society_bud_mahayana
												}
											}
											
											AND = {
												has_province_modifier = secret_cathar_community
												ROOT = {
													society_member_of = secret_religious_society_cathar
												}
											}
											
											AND = {
												has_province_modifier = secret_dionysos_community
												ROOT = {
													society_member_of = secret_religious_society_dionysos
												}
											}
											
											AND = {
												has_province_modifier = secret_donatist_community
												ROOT = {
													society_member_of = secret_religious_society_donatist
												}
											}
											
											AND = {
												has_province_modifier = secret_druze_community
												ROOT = {
													society_member_of = secret_religious_society_druze
												}
											}
											
											AND = {
												has_province_modifier = secret_erlik_community
												ROOT = {
													society_member_of = secret_religious_society_erlik
												}
											}
											
											AND = {
												has_province_modifier = secret_haruri_community
												ROOT = {
													society_member_of = secret_religious_society_haruri
												}
											}
											
											AND = {
												has_province_modifier = secret_hubal_community
												ROOT = {
													society_member_of = secret_religious_society_hubal
												}
											}
											
											AND = {
												has_province_modifier = secret_hurufi_community
												ROOT = {
													society_member_of = secret_religious_society_hurufi
												}
											}
											
											AND = {
												has_province_modifier = secret_ibadi_community
												ROOT = {
													society_member_of = secret_religious_society_ibadi
												}
											}
											
											AND = {
												has_province_modifier = secret_iconoclast_community
												ROOT = {
													society_member_of = secret_religious_society_iconoclast
												}
											}
											
											AND = {
												has_province_modifier = secret_illuyanka_community
												ROOT = {
													society_member_of = secret_religious_society_illuyanka
												}
											}
											
											AND = {
												has_province_modifier = secret_irminsul_community
												ROOT = {
													society_member_of = secret_religious_society_irminsul
												}
											}
											
											AND = {
												has_province_modifier = secret_jud_sabaoth_community
												ROOT = {
													society_member_of = secret_religious_society_jud_sabaoth
												}
											}
											
											AND = {
												has_province_modifier = secret_kharijite_community
												ROOT = {
													society_member_of = secret_religious_society_kharijite
												}
											}
											
											AND = {
												has_province_modifier = secret_mand_ruha_community
												ROOT = {
													society_member_of = secret_religious_society_mand_ruha
												}
											}
											
											AND = {
												has_province_modifier = secret_mani_ahriman_community
												ROOT = {
													society_member_of = secret_religious_society_mani_ahriman
												}
											}
											
											AND = {
												has_province_modifier = secret_mazdakism_community
												ROOT = {
													society_member_of = secret_religious_society_mazdakism
												}
											}
											
											AND = {
												has_province_modifier = secret_melkite_community
												ROOT = {
													society_member_of = secret_religious_society_melkite
												}
											}
											
											AND = {
												has_province_modifier = secret_montanist_community
												ROOT = {
													society_member_of = secret_religious_society_montanist
												}
											}
											
											AND = {
												has_province_modifier = secret_norse_war_community
												ROOT = {
													society_member_of = secret_religious_society_norse_war
												}
											}
											
											AND = {
												has_province_modifier = secret_pelagian_community
												ROOT = {
													society_member_of = secret_religious_society_pelagian
												}
											}
											
											AND = {
												has_province_modifier = secret_plato_christ_community
												ROOT = {
													society_member_of = secret_religious_society_plato_christ
												}
											}
											
											AND = {
												has_province_modifier = secret_plato_islam_community
												ROOT = {
													society_member_of = secret_religious_society_plato_islam
												}
											}
											
											AND = {
												has_province_modifier = secret_priscillian_community
												ROOT = {
													society_member_of = secret_religious_society_priscillian
												}
											}
											
											AND = {
												has_province_modifier = secret_qarmatian_community
												ROOT = {
													society_member_of = secret_religious_society_qarmatian
												}
											}
											
											AND = {
												has_province_modifier = secret_ragnarok_community
												ROOT = {
													society_member_of = secret_religious_society_ragnarok
												}
											}
											
											AND = {
												has_province_modifier = secret_saule_community
												ROOT = {
													society_member_of = secret_religious_society_saule
												}
											}
											
											AND = {
												has_province_modifier = secret_saura_community
												ROOT = {
													society_member_of = secret_religious_society_saura
												}
											}
											
											AND = {
												has_province_modifier = secret_set_community
												ROOT = {
													society_member_of = secret_religious_society_set
												}
											}
											
											AND = {
												has_province_modifier = secret_sol_christ_community
												ROOT = {
													society_member_of = secret_religious_society_sol_christ
												}
											}
											
											AND = {
												has_province_modifier = secret_sufi_community
												ROOT = {
													society_member_of = secret_religious_society_sufi
												}
											}
											
											AND = {
												has_province_modifier = secret_tengri_ahriman_community
												ROOT = {
													society_member_of = secret_religious_society_tengri_ahriman
												}
											}
											
											AND = {
												has_province_modifier = secret_vidharma_community
												ROOT = {
													society_member_of = secret_religious_society_vidharma
												}
											}
											
											AND = {
												has_province_modifier = secret_yahyanism_community
												ROOT = {
													society_member_of = secret_religious_society_yahyanism
												}
											}
											
											AND = {
												has_province_modifier = secret_zor_angra_community
												ROOT = {
													society_member_of = secret_religious_society_zor_angra
												}
											}
										}
									}
								}
								if = {
									limit = { NOT = { has_character_flag = currently_part_of_secret_religion_uncovering } }
									character_event = { id = MNM.3820 } # Flip provinces with local cult modifier
								}
								if = {
									limit = { has_character_flag = currently_part_of_secret_religion_uncovering }
									ROOT = {
										trigger_switch = {
											on_trigger = society_member_of
											secret_religious_society_antinomian = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_antinomian_community
														}
														religion = antinomian
														remove_province_modifier = secret_antinomian_community
													}
												}
											} 
										}
									}
								}
							}
							if = {
								limit = {
									is_ruler = yes
									any_demesne_province = {
										has_province_modifier = secret_aten_community
										ROOT = {
											society_member_of = secret_religious_society_aten 	
										}
									}
								}
								if = {
									limit = { NOT = { has_character_flag = currently_part_of_secret_religion_uncovering } }
									character_event = { id = MNM.3820 } # Flip provinces with local cult modifier
								}
								if = {
									limit = { has_character_flag = currently_part_of_secret_religion_uncovering }
									ROOT = {
										trigger_switch = {
											on_trigger = society_member_of
											secret_religious_society_aten = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_aten_community
														}
														religion = aten
														remove_province_modifier = secret_aten_community
													}
												}
											} 
										}
									}
								}
							}
							if = {
								limit = {
									is_ruler = yes
									any_demesne_province = {
										has_province_modifier = secret_batembuzi_community
										ROOT = {
											society_member_of = secret_religious_society_batembuzi 	
										}
									}
								}
								if = {
									limit = { NOT = { has_character_flag = currently_part_of_secret_religion_uncovering } }
									character_event = { id = MNM.3820 } # Flip provinces with local cult modifier
								}
								if = {
									limit = { has_character_flag = currently_part_of_secret_religion_uncovering }
									ROOT = {
										trigger_switch = {
											on_trigger = society_member_of
											secret_religious_society_batembuzi = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_batembuzi_community
														}
														religion = batembuzi
														remove_province_modifier = secret_batembuzi_community
													}
												}
											} 
										}
									}
								}
							}
							if = {
								limit = {
									is_ruler = yes
									any_demesne_province = {
										has_province_modifier = secret_bud_bahusrutiya_community
										ROOT = {
											society_member_of = secret_religious_society_bud_bahusrutiya 	
										}
									}
								}
								if = {
									limit = { NOT = { has_character_flag = currently_part_of_secret_religion_uncovering } }
									character_event = { id = MNM.3820 } # Flip provinces with local cult modifier
								}
								if = {
									limit = { has_character_flag = currently_part_of_secret_religion_uncovering }
									ROOT = {
										trigger_switch = {
											on_trigger = society_member_of
											secret_religious_society_bud_bahusrutiya = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_bud_bahusrutiya_community
														}
														religion = bud_bahusrutiya
														remove_province_modifier = secret_bud_bahusrutiya_community
													}
												}
											} 
										}
									}
								}
							}
							if = {
								limit = {
									is_ruler = yes
									any_demesne_province = {
										has_province_modifier = secret_bud_mahayana_community
										ROOT = {
											society_member_of = secret_religious_society_bud_mahayana 	
										}
									}
								}
								if = {
									limit = { NOT = { has_character_flag = currently_part_of_secret_religion_uncovering } }
									character_event = { id = MNM.3820 } # Flip provinces with local cult modifier
								}
								if = {
									limit = { has_character_flag = currently_part_of_secret_religion_uncovering }
									ROOT = {
										trigger_switch = {
											on_trigger = society_member_of
											secret_religious_society_bud_mahayana = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_bud_mahayana_community
														}
														religion = bud_mahayana
														remove_province_modifier = secret_bud_mahayana_community
													}
												}
											} 
										}
									}
								}
							}
							if = {
								limit = {
									is_ruler = yes
									any_demesne_province = {
										has_province_modifier = secret_cathar_community
										ROOT = {
											society_member_of = secret_religious_society_cathar 	
										}
									}
								}
								if = {
									limit = { NOT = { has_character_flag = currently_part_of_secret_religion_uncovering } }
									character_event = { id = MNM.3820 } # Flip provinces with local cult modifier
								}
								if = {
									limit = { has_character_flag = currently_part_of_secret_religion_uncovering }
									ROOT = {
										trigger_switch = {
											on_trigger = society_member_of
											secret_religious_society_cathar = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_cathar_community
														}
														religion = cathar
														remove_province_modifier = secret_cathar_community
													}
												}
											} 
										}
									}
								}
							}
							if = {
								limit = {
									is_ruler = yes
									any_demesne_province = {
										has_province_modifier = secret_dionysos_community
										ROOT = {
											society_member_of = secret_religious_society_dionysos 	
										}
									}
								}
								if = {
									limit = { NOT = { has_character_flag = currently_part_of_secret_religion_uncovering } }
									character_event = { id = MNM.3820 } # Flip provinces with local cult modifier
								}
								if = {
									limit = { has_character_flag = currently_part_of_secret_religion_uncovering }
									ROOT = {
										trigger_switch = {
											on_trigger = society_member_of
											secret_religious_society_dionysos = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_dionysos_community
														}
														religion = dionysos
														remove_province_modifier = secret_dionysos_community
													}
												}
											} 
										}
									}
								}
							}
							if = {
								limit = {
									is_ruler = yes
									any_demesne_province = {
										has_province_modifier = secret_donatist_community
										ROOT = {
											society_member_of = secret_religious_society_donatist 	
										}
									}
								}
								if = {
									limit = { NOT = { has_character_flag = currently_part_of_secret_religion_uncovering } }
									character_event = { id = MNM.3820 } # Flip provinces with local cult modifier
								}
								if = {
									limit = { has_character_flag = currently_part_of_secret_religion_uncovering }
									ROOT = {
										trigger_switch = {
											on_trigger = society_member_of
											secret_religious_society_donatist = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_donatist_community
														}
														religion = donatist
														remove_province_modifier = secret_donatist_community
													}
												}
											} 
										}
									}
								}
							}
							if = {
								limit = {
									is_ruler = yes
									any_demesne_province = {
										has_province_modifier = secret_druze_community
										ROOT = {
											society_member_of = secret_religious_society_druze 	
										}
									}
								}
								if = {
									limit = { NOT = { has_character_flag = currently_part_of_secret_religion_uncovering } }
									character_event = { id = MNM.3820 } # Flip provinces with local cult modifier
								}
								if = {
									limit = { has_character_flag = currently_part_of_secret_religion_uncovering }
									ROOT = {
										trigger_switch = {
											on_trigger = society_member_of
											secret_religious_society_druze = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_druze_community
														}
														religion = druze
														remove_province_modifier = secret_druze_community
													}
												}
											} 
										}
									}
								}
							}
							if = {
								limit = {
									is_ruler = yes
									any_demesne_province = {
										has_province_modifier = secret_erlik_community
										ROOT = {
											society_member_of = secret_religious_society_erlik 	
										}
									}
								}
								if = {
									limit = { NOT = { has_character_flag = currently_part_of_secret_religion_uncovering } }
									character_event = { id = MNM.3820 } # Flip provinces with local cult modifier
								}
								if = {
									limit = { has_character_flag = currently_part_of_secret_religion_uncovering }
									ROOT = {
										trigger_switch = {
											on_trigger = society_member_of
											secret_religious_society_erlik = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_erlik_community
														}
														religion = erlik
														remove_province_modifier = secret_erlik_community
													}
												}
											} 
										}
									}
								}
							}
							if = {
								limit = {
									is_ruler = yes
									any_demesne_province = {
										has_province_modifier = secret_haruri_community
										ROOT = {
											society_member_of = secret_religious_society_haruri 	
										}
									}
								}
								if = {
									limit = { NOT = { has_character_flag = currently_part_of_secret_religion_uncovering } }
									character_event = { id = MNM.3820 } # Flip provinces with local cult modifier
								}
								if = {
									limit = { has_character_flag = currently_part_of_secret_religion_uncovering }
									ROOT = {
										trigger_switch = {
											on_trigger = society_member_of
											secret_religious_society_haruri = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_haruri_community
														}
														religion = haruri
														remove_province_modifier = secret_haruri_community
													}
												}
											} 
										}
									}
								}
							}
							if = {
								limit = {
									is_ruler = yes
									any_demesne_province = {
										has_province_modifier = secret_hubal_community
										ROOT = {
											society_member_of = secret_religious_society_hubal 	
										}
									}
								}
								if = {
									limit = { NOT = { has_character_flag = currently_part_of_secret_religion_uncovering } }
									character_event = { id = MNM.3820 } # Flip provinces with local cult modifier
								}
								if = {
									limit = { has_character_flag = currently_part_of_secret_religion_uncovering }
									ROOT = {
										trigger_switch = {
											on_trigger = society_member_of
											secret_religious_society_hubal = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_hubal_community
														}
														religion = hubal
														remove_province_modifier = secret_hubal_community
													}
												}
											} 
										}
									}
								}
							}
							if = {
								limit = {
									is_ruler = yes
									any_demesne_province = {
										has_province_modifier = secret_hurufi_community
										ROOT = {
											society_member_of = secret_religious_society_hurufi 	
										}
									}
								}
								if = {
									limit = { NOT = { has_character_flag = currently_part_of_secret_religion_uncovering } }
									character_event = { id = MNM.3820 } # Flip provinces with local cult modifier
								}
								if = {
									limit = { has_character_flag = currently_part_of_secret_religion_uncovering }
									ROOT = {
										trigger_switch = {
											on_trigger = society_member_of
											secret_religious_society_hurufi = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_hurufi_community
														}
														religion = hurufi
														remove_province_modifier = secret_hurufi_community
													}
												}
											} 
										}
									}
								}
							}
							if = {
								limit = {
									is_ruler = yes
									any_demesne_province = {
										has_province_modifier = secret_ibadi_community
										ROOT = {
											society_member_of = secret_religious_society_ibadi 	
										}
									}
								}
								if = {
									limit = { NOT = { has_character_flag = currently_part_of_secret_religion_uncovering } }
									character_event = { id = MNM.3820 } # Flip provinces with local cult modifier
								}
								if = {
									limit = { has_character_flag = currently_part_of_secret_religion_uncovering }
									ROOT = {
										trigger_switch = {
											on_trigger = society_member_of
											secret_religious_society_ibadi = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_ibadi_community
														}
														religion = ibadi
														remove_province_modifier = secret_ibadi_community
													}
												}
											} 
										}
									}
								}
							}
							if = {
								limit = {
									is_ruler = yes
									any_demesne_province = {
										has_province_modifier = secret_iconoclast_community
										ROOT = {
											society_member_of = secret_religious_society_iconoclast 	
										}
									}
								}
								if = {
									limit = { NOT = { has_character_flag = currently_part_of_secret_religion_uncovering } }
									character_event = { id = MNM.3820 } # Flip provinces with local cult modifier
								}
								if = {
									limit = { has_character_flag = currently_part_of_secret_religion_uncovering }
									ROOT = {
										trigger_switch = {
											on_trigger = society_member_of
											secret_religious_society_iconoclast = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_iconoclast_community
														}
														religion = iconoclast
														remove_province_modifier = secret_iconoclast_community
													}
												}
											} 
										}
									}
								}
							}
							if = {
								limit = {
									is_ruler = yes
									any_demesne_province = {
										has_province_modifier = secret_illuyanka_community
										ROOT = {
											society_member_of = secret_religious_society_illuyanka 	
										}
									}
								}
								if = {
									limit = { NOT = { has_character_flag = currently_part_of_secret_religion_uncovering } }
									character_event = { id = MNM.3820 } # Flip provinces with local cult modifier
								}
								if = {
									limit = { has_character_flag = currently_part_of_secret_religion_uncovering }
									ROOT = {
										trigger_switch = {
											on_trigger = society_member_of
											secret_religious_society_illuyanka = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_illuyanka_community
														}
														religion = illuyanka
														remove_province_modifier = secret_illuyanka_community
													}
												}
											} 
										}
									}
								}
							}
							if = {
								limit = {
									is_ruler = yes
									any_demesne_province = {
										has_province_modifier = secret_irminsul_community
										ROOT = {
											society_member_of = secret_religious_society_irminsul 	
										}
									}
								}
								if = {
									limit = { NOT = { has_character_flag = currently_part_of_secret_religion_uncovering } }
									character_event = { id = MNM.3820 } # Flip provinces with local cult modifier
								}
								if = {
									limit = { has_character_flag = currently_part_of_secret_religion_uncovering }
									ROOT = {
										trigger_switch = {
											on_trigger = society_member_of
											secret_religious_society_irminsul = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_irminsul_community
														}
														religion = irminsul
														remove_province_modifier = secret_irminsul_community
													}
												}
											} 
										}
									}
								}
							}
							if = {
								limit = {
									is_ruler = yes
									any_demesne_province = {
										has_province_modifier = secret_jud_sabaoth_community
										ROOT = {
											society_member_of = secret_religious_society_jud_sabaoth 	
										}
									}
								}
								if = {
									limit = { NOT = { has_character_flag = currently_part_of_secret_religion_uncovering } }
									character_event = { id = MNM.3820 } # Flip provinces with local cult modifier
								}
								if = {
									limit = { has_character_flag = currently_part_of_secret_religion_uncovering }
									ROOT = {
										trigger_switch = {
											on_trigger = society_member_of
											secret_religious_society_jud_sabaoth = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_jud_sabaoth_community
														}
														religion = jud_sabaoth
														remove_province_modifier = secret_jud_sabaoth_community
													}
												}
											} 
										}
									}
								}
							}
							if = {
								limit = {
									is_ruler = yes
									any_demesne_province = {
										has_province_modifier = secret_kharijite_community
										ROOT = {
											society_member_of = secret_religious_society_kharijite 	
										}
									}
								}
								if = {
									limit = { NOT = { has_character_flag = currently_part_of_secret_religion_uncovering } }
									character_event = { id = MNM.3820 } # Flip provinces with local cult modifier
								}
								if = {
									limit = { has_character_flag = currently_part_of_secret_religion_uncovering }
									ROOT = {
										trigger_switch = {
											on_trigger = society_member_of
											secret_religious_society_kharijite = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_kharijite_community
														}
														religion = kharijite
														remove_province_modifier = secret_kharijite_community
													}
												}
											} 
										}
									}
								}
							}
							if = {
								limit = {
									is_ruler = yes
									any_demesne_province = {
										has_province_modifier = secret_mand_ruha_community
										ROOT = {
											society_member_of = secret_religious_society_mand_ruha 	
										}
									}
								}
								if = {
									limit = { NOT = { has_character_flag = currently_part_of_secret_religion_uncovering } }
									character_event = { id = MNM.3820 } # Flip provinces with local cult modifier
								}
								if = {
									limit = { has_character_flag = currently_part_of_secret_religion_uncovering }
									ROOT = {
										trigger_switch = {
											on_trigger = society_member_of
											secret_religious_society_mand_ruha = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_mand_ruha_community
														}
														religion = mand_ruha
														remove_province_modifier = secret_mand_ruha_community
													}
												}
											} 
										}
									}
								}
							}
							if = {
								limit = {
									is_ruler = yes
									any_demesne_province = {
										has_province_modifier = secret_mani_ahriman_community
										ROOT = {
											society_member_of = secret_religious_society_mani_ahriman 	
										}
									}
								}
								if = {
									limit = { NOT = { has_character_flag = currently_part_of_secret_religion_uncovering } }
									character_event = { id = MNM.3820 } # Flip provinces with local cult modifier
								}
								if = {
									limit = { has_character_flag = currently_part_of_secret_religion_uncovering }
									ROOT = {
										trigger_switch = {
											on_trigger = society_member_of
											secret_religious_society_mani_ahriman = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_mani_ahriman_community
														}
														religion = mani_ahriman
														remove_province_modifier = secret_mani_ahriman_community
													}
												}
											} 
										}
									}
								}
							}
							if = {
								limit = {
									is_ruler = yes
									any_demesne_province = {
										has_province_modifier = secret_mazdakism_community
										ROOT = {
											society_member_of = secret_religious_society_mazdakism 	
										}
									}
								}
								if = {
									limit = { NOT = { has_character_flag = currently_part_of_secret_religion_uncovering } }
									character_event = { id = MNM.3820 } # Flip provinces with local cult modifier
								}
								if = {
									limit = { has_character_flag = currently_part_of_secret_religion_uncovering }
									ROOT = {
										trigger_switch = {
											on_trigger = society_member_of
											secret_religious_society_mazdakism = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_mazdakism_community
														}
														religion = mazdakism
														remove_province_modifier = secret_mazdakism_community
													}
												}
											} 
										}
									}
								}
							}
							if = {
								limit = {
									is_ruler = yes
									any_demesne_province = {
										has_province_modifier = secret_melkite_community
										ROOT = {
											society_member_of = secret_religious_society_melkite 	
										}
									}
								}
								if = {
									limit = { NOT = { has_character_flag = currently_part_of_secret_religion_uncovering } }
									character_event = { id = MNM.3820 } # Flip provinces with local cult modifier
								}
								if = {
									limit = { has_character_flag = currently_part_of_secret_religion_uncovering }
									ROOT = {
										trigger_switch = {
											on_trigger = society_member_of
											secret_religious_society_melkite = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_melkite_community
														}
														religion = melkite
														remove_province_modifier = secret_melkite_community
													}
												}
											} 
										}
									}
								}
							}
							if = {
								limit = {
									is_ruler = yes
									any_demesne_province = {
										has_province_modifier = secret_montanist_community
										ROOT = {
											society_member_of = secret_religious_society_montanist 	
										}
									}
								}
								if = {
									limit = { NOT = { has_character_flag = currently_part_of_secret_religion_uncovering } }
									character_event = { id = MNM.3820 } # Flip provinces with local cult modifier
								}
								if = {
									limit = { has_character_flag = currently_part_of_secret_religion_uncovering }
									ROOT = {
										trigger_switch = {
											on_trigger = society_member_of
											secret_religious_society_montanist = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_montanist_community
														}
														religion = montanist
														remove_province_modifier = secret_montanist_community
													}
												}
											} 
										}
									}
								}
							}
							if = {
								limit = {
									is_ruler = yes
									any_demesne_province = {
										has_province_modifier = secret_norse_war_community
										ROOT = {
											society_member_of = secret_religious_society_norse_war 	
										}
									}
								}
								if = {
									limit = { NOT = { has_character_flag = currently_part_of_secret_religion_uncovering } }
									character_event = { id = MNM.3820 } # Flip provinces with local cult modifier
								}
								if = {
									limit = { has_character_flag = currently_part_of_secret_religion_uncovering }
									ROOT = {
										trigger_switch = {
											on_trigger = society_member_of
											secret_religious_society_norse_war = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_norse_war_community
														}
														religion = norse_war
														remove_province_modifier = secret_norse_war_community
													}
												}
											} 
										}
									}
								}
							}
							if = {
								limit = {
									is_ruler = yes
									any_demesne_province = {
										has_province_modifier = secret_pelagian_community
										ROOT = {
											society_member_of = secret_religious_society_pelagian 	
										}
									}
								}
								if = {
									limit = { NOT = { has_character_flag = currently_part_of_secret_religion_uncovering } }
									character_event = { id = MNM.3820 } # Flip provinces with local cult modifier
								}
								if = {
									limit = { has_character_flag = currently_part_of_secret_religion_uncovering }
									ROOT = {
										trigger_switch = {
											on_trigger = society_member_of
											secret_religious_society_pelagian = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_pelagian_community
														}
														religion = pelagian
														remove_province_modifier = secret_pelagian_community
													}
												}
											} 
										}
									}
								}
							}
							if = {
								limit = {
									is_ruler = yes
									any_demesne_province = {
										has_province_modifier = secret_plato_christ_community
										ROOT = {
											society_member_of = secret_religious_society_plato_christ 	
										}
									}
								}
								if = {
									limit = { NOT = { has_character_flag = currently_part_of_secret_religion_uncovering } }
									character_event = { id = MNM.3820 } # Flip provinces with local cult modifier
								}
								if = {
									limit = { has_character_flag = currently_part_of_secret_religion_uncovering }
									ROOT = {
										trigger_switch = {
											on_trigger = society_member_of
											secret_religious_society_plato_christ = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_plato_christ_community
														}
														religion = plato_christ
														remove_province_modifier = secret_plato_christ_community
													}
												}
											} 
										}
									}
								}
							}
							if = {
								limit = {
									is_ruler = yes
									any_demesne_province = {
										has_province_modifier = secret_plato_islam_community
										ROOT = {
											society_member_of = secret_religious_society_plato_islam 	
										}
									}
								}
								if = {
									limit = { NOT = { has_character_flag = currently_part_of_secret_religion_uncovering } }
									character_event = { id = MNM.3820 } # Flip provinces with local cult modifier
								}
								if = {
									limit = { has_character_flag = currently_part_of_secret_religion_uncovering }
									ROOT = {
										trigger_switch = {
											on_trigger = society_member_of
											secret_religious_society_plato_islam = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_plato_islam_community
														}
														religion = plato_islam
														remove_province_modifier = secret_plato_islam_community
													}
												}
											} 
										}
									}
								}
							}
							if = {
								limit = {
									is_ruler = yes
									any_demesne_province = {
										has_province_modifier = secret_priscillian_community
										ROOT = {
											society_member_of = secret_religious_society_priscillian 	
										}
									}
								}
								if = {
									limit = { NOT = { has_character_flag = currently_part_of_secret_religion_uncovering } }
									character_event = { id = MNM.3820 } # Flip provinces with local cult modifier
								}
								if = {
									limit = { has_character_flag = currently_part_of_secret_religion_uncovering }
									ROOT = {
										trigger_switch = {
											on_trigger = society_member_of
											secret_religious_society_priscillian= {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_priscillian_community
														}
														religion = priscillian
														remove_province_modifier = secret_priscillian_community
													}
												}
											} 
										}
									}
								}
							}
							if = {
								limit = {
									is_ruler = yes
									any_demesne_province = {
										has_province_modifier = secret_qarmatian_community
										ROOT = {
											society_member_of = secret_religious_society_qarmatian 	
										}
									}
								}
								if = {
									limit = { NOT = { has_character_flag = currently_part_of_secret_religion_uncovering } }
									character_event = { id = MNM.3820 } # Flip provinces with local cult modifier
								}
								if = {
									limit = { has_character_flag = currently_part_of_secret_religion_uncovering }
									ROOT = {
										trigger_switch = {
											on_trigger = society_member_of
											secret_religious_society_qarmatian = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_qarmatian_community
														}
														religion = qarmatian
														remove_province_modifier = secret_qarmatian_community
													}
												}
											} 
										}
									}
								}
							}
							if = {
								limit = {
									is_ruler = yes
									any_demesne_province = {
										has_province_modifier = secret_ragnarok_community
										ROOT = {
											society_member_of = secret_religious_society_ragnarok 	
										}
									}
								}
								if = {
									limit = { NOT = { has_character_flag = currently_part_of_secret_religion_uncovering } }
									character_event = { id = MNM.3820 } # Flip provinces with local cult modifier
								}
								if = {
									limit = { has_character_flag = currently_part_of_secret_religion_uncovering }
									ROOT = {
										trigger_switch = {
											on_trigger = society_member_of
											secret_religious_society_ragnarok = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_ragnarok_community
														}
														religion = ragnarok
														remove_province_modifier = secret_ragnarok_community
													}
												}
											} 
										}
									}
								}
							}
							if = {
								limit = {
									is_ruler = yes
									any_demesne_province = {
										has_province_modifier = secret_saule_community
										ROOT = {
											society_member_of = secret_religious_society_saule 	
										}
									}
								}
								if = {
									limit = { NOT = { has_character_flag = currently_part_of_secret_religion_uncovering } }
									character_event = { id = MNM.3820 } # Flip provinces with local cult modifier
								}
								if = {
									limit = { has_character_flag = currently_part_of_secret_religion_uncovering }
									ROOT = {
										trigger_switch = {
											on_trigger = society_member_of
											secret_religious_society_saule = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_saule_community
														}
														religion = saule
														remove_province_modifier = secret_saule_community
													}
												}
											} 
										}
									}
								}
							}
							if = {
								limit = {
									is_ruler = yes
									any_demesne_province = {
										has_province_modifier = secret_saura_community
										ROOT = {
											society_member_of = secret_religious_society_saura 	
										}
									}
								}
								if = {
									limit = { NOT = { has_character_flag = currently_part_of_secret_religion_uncovering } }
									character_event = { id = MNM.3820 } # Flip provinces with local cult modifier
								}
								if = {
									limit = { has_character_flag = currently_part_of_secret_religion_uncovering }
									ROOT = {
										trigger_switch = {
											on_trigger = society_member_of
											secret_religious_society_saura = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_saura_community
														}
														religion = saura
														remove_province_modifier = secret_saura_community
													}
												}
											} 
										}
									}
								}
							}
							if = {
								limit = {
									is_ruler = yes
									any_demesne_province = {
										has_province_modifier = secret_set_community
										ROOT = {
											society_member_of = secret_religious_society_set 	
										}
									}
								}
								if = {
									limit = { NOT = { has_character_flag = currently_part_of_secret_religion_uncovering } }
									character_event = { id = MNM.3820 } # Flip provinces with local cult modifier
								}
								if = {
									limit = { has_character_flag = currently_part_of_secret_religion_uncovering }
									ROOT = {
										trigger_switch = {
											on_trigger = society_member_of
											secret_religious_society_set = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_set_community
														}
														religion = set
														remove_province_modifier = secret_set_community
													}
												}
											} 
										}
									}
								}
							}
							if = {
								limit = {
									is_ruler = yes
									any_demesne_province = {
										has_province_modifier = secret_sol_christ_community
										ROOT = {
											society_member_of = secret_religious_society_sol_christ 	
										}
									}
								}
								if = {
									limit = { NOT = { has_character_flag = currently_part_of_secret_religion_uncovering } }
									character_event = { id = MNM.3820 } # Flip provinces with local cult modifier
								}
								if = {
									limit = { has_character_flag = currently_part_of_secret_religion_uncovering }
									ROOT = {
										trigger_switch = {
											on_trigger = society_member_of
											secret_religious_society_sol_christ = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_sol_christ_community
														}
														religion = sol_christ
														remove_province_modifier = secret_sol_christ_community
													}
												}
											} 
										}
									}
								}
							}
							if = {
								limit = {
									is_ruler = yes
									any_demesne_province = {
										has_province_modifier = secret_sufi_community
										ROOT = {
											society_member_of = secret_religious_society_sufi 	
										}
									}
								}
								if = {
									limit = { NOT = { has_character_flag = currently_part_of_secret_religion_uncovering } }
									character_event = { id = MNM.3820 } # Flip provinces with local cult modifier
								}
								if = {
									limit = { has_character_flag = currently_part_of_secret_religion_uncovering }
									ROOT = {
										trigger_switch = {
											on_trigger = society_member_of
											secret_religious_society_sufi = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_sufi_community
														}
														religion = sufi
														remove_province_modifier = secret_sufi_community
													}
												}
											} 
										}
									}
								}
							}
							if = {
								limit = {
									is_ruler = yes
									any_demesne_province = {
										has_province_modifier = secret_tengri_ahriman_community
										ROOT = {
											society_member_of = secret_religious_society_tengri_ahriman 	
										}
									}
								}
								if = {
									limit = { NOT = { has_character_flag = currently_part_of_secret_religion_uncovering } }
									character_event = { id = MNM.3820 } # Flip provinces with local cult modifier
								}
								if = {
									limit = { has_character_flag = currently_part_of_secret_religion_uncovering }
									ROOT = {
										trigger_switch = {
											on_trigger = society_member_of
											secret_religious_society_tengri_ahriman = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_tengri_ahriman_community
														}
														religion = tengri_ahriman
														remove_province_modifier = secret_tengri_ahriman_community
													}
												}
											} 
										}
									}
								}
							}
							if = {
								limit = {
									is_ruler = yes
									any_demesne_province = {
										has_province_modifier = secret_vidharma_community
										ROOT = {
											society_member_of = secret_religious_society_vidharma 	
										}
									}
								}
								if = {
									limit = { NOT = { has_character_flag = currently_part_of_secret_religion_uncovering } }
									character_event = { id = MNM.3820 } # Flip provinces with local cult modifier
								}
								if = {
									limit = { has_character_flag = currently_part_of_secret_religion_uncovering }
									ROOT = {
										trigger_switch = {
											on_trigger = society_member_of
											secret_religious_society_vidharma = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_vidharma_community
														}
														religion = vidharma
														remove_province_modifier = secret_vidharma_community
													}
												}
											} 
										}
									}
								}
							}
							if = {
								limit = {
									is_ruler = yes
									any_demesne_province = {
										has_province_modifier = secret_yahyanism_community
										ROOT = {
											society_member_of = secret_religious_society_yahyanism 	
										}
									}
								}
								if = {
									limit = { NOT = { has_character_flag = currently_part_of_secret_religion_uncovering } }
									character_event = { id = MNM.3820 } # Flip provinces with local cult modifier
								}
								if = {
									limit = { has_character_flag = currently_part_of_secret_religion_uncovering }
									ROOT = {
										trigger_switch = {
											on_trigger = society_member_of
											secret_religious_society_yahyanism = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_yahyanism_community
														}
														religion = yahyanism
														remove_province_modifier = secret_yahyanism_community
													}
												}
											} 
										}
									}
								}
							}
							if = {
								limit = {
									is_ruler = yes
									any_demesne_province = {
										has_province_modifier = secret_zor_angra_community
										ROOT = {
											society_member_of = secret_religious_society_zor_angra 	
										}
									}
								}
								if = {
									limit = { NOT = { has_character_flag = currently_part_of_secret_religion_uncovering } }
									character_event = { id = MNM.3820 } # Flip provinces with local cult modifier
								}
								if = {
									limit = { has_character_flag = currently_part_of_secret_religion_uncovering }
									ROOT = {
										trigger_switch = {
											on_trigger = society_member_of
											secret_religious_society_zor_angra = {
												PREV = {
													any_demesne_province = {
														limit = {
															has_province_modifier = secret_zor_angra_community
														}
														religion = zor_angra
														remove_province_modifier = secret_zor_angra_community
													}
												}
											} 
										}
									}
								}
							}
						}
					}
					flip_secret_religious_community_provinces = yes
					flip_to_secret_religion_effect = yes
					
					top_liege = {
						any_realm_lord = {
							character_event = { id = MNM.3830 } # Inform lieges unless they're part of the cult flipping, save a flag on previous events.
						}
						
						any_realm_character = {
							limit = {
								NOT = {
									character = ROOT
								}
								same_society_as = ROOT
							}
							leave_society = yes
						}
						
						any_realm_character = {
							limit = {
								has_character_flag = currently_part_of_secret_religion_uncovering
							}
							clr_character_flag = currently_part_of_secret_religion_uncovering
						}
					}
					any_society_member = {
						limit = {
							NOT = {
								character = ROOT
							}
							same_society_as = ROOT
						}
						leave_society = yes
					}
					leave_society = yes
				}
			}
		}
		
		#revoke_allowed = {
			#always = no
		#}
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1 # Slow down
			}
			modifier = {
				factor = 0.1
				is_landed = no
			}
			modifier = {
				factor = 0
				prisoner = yes
			}
			modifier = {
				factor = 0.001
				any_society_member = {
					NOT = { character = ROOT }
					same_realm = ROOT
					ai = no
				}
				NOT = {
					top_liege = {
						OR = {
							same_society_as = ROOT
							is_openly_of_roots_secret_religion_trigger = yes
						}
					}
				}
			}
			modifier = {
				factor = 0
				top_liege = {
					war = yes
				}
			}
			modifier = { #Don't do it unless you are confident in support
				factor = 0
				NOR = {
					AND = { # The Top Liege is in the Secret Cult, and at least 3 of the Liege's direct vassals are also members
						top_liege = {
							OR = {
								same_society_as = ROOT
								is_openly_of_roots_secret_religion_trigger = yes
							}
						}
						top_liege = {
							any_vassal = {
								count = 3
								higher_tier_than = BARON
								prisoner = no
								OR = {
									same_society_as = ROOT
									is_openly_of_roots_secret_religion_trigger = yes
								}
							}
						}
					}
					top_liege = { # At least 5 direct vassals of the Top Liege is in the Secret Cult
						any_vassal = {
							count = 5
							higher_tier_than = BARON
							prisoner = no
							OR = {
								same_society_as = ROOT
								is_openly_of_roots_secret_religion_trigger = yes
							}
						}
					}
					top_liege = { # All direct vassals of the Top Liege are in the Secret Cult
						NOT = {
							any_vassal = {
								higher_tier_than = BARON
								NOR = {
									same_society_as = ROOT
									is_openly_of_roots_secret_religion_trigger = yes
								}
							}
						}
					}
					top_liege = {
						realm_character_percent = {
							target = 0.30
							OR = {
								same_society_as = ROOT
								is_openly_of_prevs_secret_religion_trigger = yes
							}
						}
					}
					AND = {
						top_liege = {
							realm_character_percent = {
								target = 0.25
								OR = {
									same_society_as = ROOT
									is_openly_of_prevs_secret_religion_trigger = yes
								}
							}
						}
						liege = {
							OR = {
								same_society_as = ROOT
								is_openly_of_prevs_secret_religion_trigger = yes
							}
						}
					}
					AND = {
						top_liege = {
							realm_character_percent = {
								target = 0.20
								OR = {
									same_society_as = ROOT
									is_openly_of_prevs_secret_religion_trigger = yes
								}
							}
						}
						top_liege = {
							OR = {
								same_society_as = ROOT
								is_openly_of_prevs_secret_religion_trigger = yes
							}
						}
						liege = {
							OR = {
								same_society_as = ROOT
								is_openly_of_prevs_secret_religion_trigger = yes
							}
						}
					}
					AND = {
						top_liege = {
							realm_character_percent = {
								target = 0.15
								OR = {
									same_society_as = ROOT
									is_openly_of_prevs_secret_religion_trigger = yes
								}
							}
						}
						any_vassal = {
							OR = {
								same_society_as = ROOT
								is_openly_of_prevs_secret_religion_trigger = yes
							}
						}
						top_liege = {
							OR = {
								same_society_as = ROOT
								is_openly_of_prevs_secret_religion_trigger = yes
							}
						}
						liege = {
							OR = {
								same_society_as = ROOT
								is_openly_of_prevs_secret_religion_trigger = yes
							}
						}
					}
				}
			}
			modifier = {
				factor = 1.5
				trait = ambitious
			}
			modifier = {
				factor = 1.5
				realm_character_percent = {
					target = 0.15
					OR = {
						same_society_as = ROOT
						is_openly_of_prevs_secret_religion_trigger = yes
					}
				}				
			}
			modifier = {
				factor = 1.5
				realm_character_percent = {
					target = 0.25
					OR = {
						same_society_as = ROOT
						is_openly_of_prevs_secret_religion_trigger = yes
					}
				}				
			}
			modifier = {
				factor = 1.5
				realm_character_percent = {
					target = 0.35
					OR = {
						same_society_as = ROOT
						is_openly_of_prevs_secret_religion_trigger = yes
					}
				}				
			}
			modifier = {
				factor = 1.5
				realm_character_percent = {
					target = 0.5
					OR = {
						same_society_as = ROOT
						is_openly_of_prevs_secret_religion_trigger = yes
					}
				}				
			}
			modifier = {
				factor = 1.5
				realm_character_percent = {
					target = 0.65
					OR = {
						same_society_as = ROOT
						is_openly_of_prevs_secret_religion_trigger = yes
					}
				}				
			}
		}
	}

	secret_religions_blend_in = {
		
		potential = {
			society_member_of = secret_religious_cult
			has_quest = quest_secret_religions_societies_blend_in
			NOT = { has_character_modifier = attempting_to_blend_in }
		}
		allow = {
			has_quest = quest_secret_religions_societies_blend_in
			prisoner = no
			NOT = { trait = incapable }
			NOT = { is_inaccessible_trigger = yes }
			custom_tooltip = {
				text = quest_secret_religions_societies_blend_in_allow_tt
				OR = {
					NOT = { has_character_flag = blending_in_timer }
					had_character_flag = { flag = blending_in_timer days = 1000 }
				}
			}
		}

		effect = {
			add_character_modifier = {
				name = attempting_to_blend_in
				duration = -1
			}
			hidden_effect = { character_event = { id = MNM.3399 } }
		}

		#revoke_allowed = {
			#always = no
		#}
		
		ai_will_do = {
			factor = 0.1

			modifier = {
				factor = 0.01
				war = yes
			}
			modifier = {
				factor = 2
				OR = {
					trait = gregarious
					trait = socializer
				}
			}
			modifier = {
				factor = 0.1
				trait = shy
			}
			modifier = {
				factor = 0.1
				is_dumb_trigger = yes
			}
		}
	}
}

targeted_decisions = {
	secret_religions_conduct_secret_ceremony = {
		is_in_society = yes
		
		filter = self
		ai_target_filter = self
		
		potential = {
			society_member_of = secret_religious_cult
			has_quest = quest_secret_religions_conduct_secret_ceremony 
		}
		allow = {
			has_quest = quest_secret_religions_conduct_secret_ceremony
			prisoner = no
			NOT = { trait = incapable }
			NOT = { is_inaccessible_trigger = yes }
			custom_tooltip = {
				text = quest_secret_religions_conduct_secret_ceremony_allow_tt
				OR = {
					NOT = { has_character_flag = conduct_secret_ceremony_timer }
					had_character_flag = { flag = conduct_secret_ceremony_timer days = 1000 }
				}
			}
		}

		effect = {
			set_character_flag = conduct_secret_ceremony_timer
			hidden_effect = { character_event = { id = MNM.3235 days = 5 } }
		}

		#revoke_allowed = {
			#always = no
		#}
		
		ai_will_do = {
			factor = 0.1
			modifier = {
				is_ruler = yes
				factor = 10
			}
			modifier = {
				diplomacy = 12
    			factor = 3
			}
			modifier = {
				diplomacy = 15
    			factor = 3
			}
			modifier = {
				trait = paranoid
    			factor = 0.1
			}
			modifier = {
				trait = craven
    			factor = 0.1
			}
		}
	}
	
	secret_religions_induct_child = {
		is_in_society = yes
		
		ai_target_filter = home_court

		from_potential = {
			society_member_of = secret_religious_cult
		}

		potential = {
			NOT = {
				character = FROM
			}
			OR = {
				mother = { character = FROM }
				father = { character = FROM }
				educator = { character = FROM }
				guardian = { character = FROM }
			}
			has_secret_religion_trait_trigger = no
			FROM = { ROOT = { is_openly_of_prevs_secret_religion_trigger = no } }
			is_adult = no
		}

		allow = {
			FROM = {
				prisoner = no
				is_inaccessible_trigger = no
				NOT = { trait = incapable }
			}
			age = 8
			prisoner = no
			NOT = { trait = incapable }
			NOT = { is_inaccessible_trigger = yes }
			custom_tooltip = {
				text = secret_religions_induct_child_allow_tt
				FROM = { shares_prevs_secret_religion_trigger = no }
			}
			custom_tooltip = {
				text = secret_religions_induct_character_cd_tt
				NOT = { has_character_modifier = secret_religions_induct_child_timer }
			}
		}

		effect = {
			custom_tooltip = {
				text = secret_religions_induct_child_effect

				FROM = { character_event = { id = MNM.3438 } }

				hidden_effect = {
					add_character_modifier = {
						name = secret_religions_induct_child_timer
						years = 6
						hidden = yes
					}
				}
			}
			FROM = { 
				if = { 
					limit = {
						is_society_grandmaster = yes
					}
					increase_visibility_minor_effect = yes
				}
				if = {
					limit = {
						NOT = { is_society_grandmaster = yes }
					}
					increase_visibility_effect = yes
				}
			}
		}

		#revoke_allowed = {
			#always = no
		#}
		
		ai_will_do = {
			factor = 1
			modifier = {
				FROM = { has_quest = quest_secret_religious_societies_induct_ruler }
    			is_quest_target_of = FROM
    			factor = 100
			}
			modifier = {
				FROM = { has_quest = quest_secret_religious_societies_induct_ruler }
    			NOT = {
					is_quest_target_of = FROM
				}
    			factor = 0.01
			}
			modifier = {
				OR = {
					mother = { character = FROM }
					father = { character = FROM }
				}
				factor = 10
			}
			modifier = {
				FROM = { current_heir = { character = ROOT } }
				factor = 10
			}
			modifier = {
				is_friend = FROM
				factor = 10
			}
			modifier = {
				trait = trusting
				factor = 5
			}
			modifier = {
				ai = no
				factor = 5
			}
			modifier = {
				OR = {
					mother = { ai = no }
					father = { ai = no }
				}
				factor = 0.1
			}
		}
	}
	
	secret_religions_recruit = {
		is_in_society = yes
		
		filter = realm 
		ai_target_filter = realm

		from_potential = {
			society_member_of = secret_religious_cult
			is_adult = yes
			prisoner = no
			NOT = { trait = incapable }
			NOT = { is_inaccessible_trigger = yes }
			OR = { # Performance saving measures
				has_society_currency_tiny_trigger = yes
				ai = no
			}
			OR = {
				ai = no
				is_society_grandmaster = yes
				num_of_society_members < 90
			}
		}

		potential = {
			OR = {
				FROM = { ai = no } #Either a player is using the decision, OR the target is interested in the AI's secret religious cult
				ai = yes # Or the target is an AI...
				AND = {
					ai = no
					is_in_society = no
					interested_in_society_of_character = FROM
				}
			}
			
			FROM = {
				OR = {
					ai = yes
					same_realm = PREV
				}
				secret_religion = PREV
			}
			
			is_adult = yes
			NOT = {
				character = FROM
				society = {
					FROM = {
						society = {
							society_type = prevprev
						}
					}
				}
			}

			#AI can't invite when the society is full
			NAND = {
				ai = yes
				FROM = { ai = yes }
				NOT = {
					FROM = {
						society = {
							ROOT = {
								can_join_society = PREV
							}
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				NOT = {
					has_character_modifier = accused_apostate
				}
				prisoner = no
				is_inaccessible_trigger = no
				NOT = { trait = incapable }
			}
			prisoner = no
			NOT = { trait = incapable }
			NOT = { is_inaccessible_trigger = yes }
			custom_tooltip = {
				text = secret_religions_recruit_allow_tt
				FROM = { shares_prevs_secret_religion_trigger = yes }
			}
			custom_tooltip = {
				text = secret_religions_recruit_cd_tt
				NOT = { has_character_modifier = secret_religions_recruitment_timer }
			}
		}

		effect = {
			custom_tooltip = { 	
				text = secret_religions_recruit_effect_tt
				FROM = { save_event_target_as = secret_religion_recruiter } 
				character_event = { id = MNM.3420 }

				add_character_modifier = {
					name = secret_religions_recruitment_timer
					years = 10
					hidden = yes
				}
			}
			FROM = { 
				if = { 
					limit = {
						is_society_grandmaster = yes
					}
					increase_visibility_minor_effect = yes
				}
				if = {
					limit = {
						NOT = { is_society_grandmaster = yes }
					}
					increase_visibility_effect = yes
				}
			}
		}

		#revoke_allowed = {
			#always = no
		#}
		
		ai_will_do = {
			factor = 1
			modifier = {
				is_ruler = yes
				factor = 10
			}
			modifier = {
				ai = no
				factor = 5
			}
			modifier = {
				diplomacy = 12
    			factor = 3
			}
			modifier = {
				diplomacy = 15
    			factor = 3
			}
			modifier = {
				trait = paranoid
    			factor = 0.1
			}
			modifier = {
				trait = craven
    			factor = 0.1
			}
			modifier = {
				factor = 0 # don't recruit characters interested in something else
				NOT = { interested_in_society = secret_religious_cult }
				is_interested_in_any_society = yes
			}
			modifier = {
				NOT = {
					any_realm_character = {
						ai = no
					}
				}
    			factor = 0.1
			}
		}
	}

	secret_religions_induct_character = {
		is_in_society = yes
		
		filter = realm
		ai_target_filter = realm
		
		from_potential = {
			society_member_of = secret_religious_cult
			society_rank >= 2
			is_adult = yes
			prisoner = no
			NOT = { trait = incapable }
			NOT = { is_inaccessible_trigger = yes }
			OR = { # Performance saving measure
				has_society_currency_tiny_trigger = yes
				ai = no
			}
			OR = {
				ai = no
				is_society_grandmaster = yes
				num_of_society_members < 90
			}
		}
		
		potential = {
			NOT = {
				character = FROM
			}
			is_adult = yes
			FROM = { 
				ROOT = { 
					NOT = {
						secret_religion = PREV
					}
					is_openly_of_prevs_secret_religion_trigger = no
				} 
			}
			FROM = { 
				ROOT = { 
					OR = {
						has_sympathy_for_true_religion_of_prev_trigger = yes
						is_openly_of_prevs_true_religion_group = yes 
					}
				}
			}
		}

		allow = {
			FROM = {
				NOT = {
					has_character_modifier = accused_apostate
				}
				prisoner = no
				is_inaccessible_trigger = no
				NOT = { trait = incapable }
			}
			prisoner = no
			NOT = { trait = incapable }
			NOT = { is_inaccessible_trigger = yes }
			custom_tooltip = {
				text = secret_religions_induct_character_cd_tt
				OR = {
					NOT = { has_character_modifier = secret_religion_induction_timer }
					has_quest = quest_secret_religious_societies_induct_ruler
				}
			}
			OR = {
				AND = {
					is_ruler = no
					FROM = { has_society_currency_tiny_trigger = yes }
				}
				hidden_tooltip = {
					FROM = {
						has_society_currency_tiny_trigger = yes
						ai = yes
						is_society_grandmaster = yes
					}
				}
				AND = {
					is_ruler = yes
					FROM = { has_society_currency_minor_trigger = yes }
				}
			}
		}

		effect = {
			if = {
				limit = { 
					is_ruler = no  
					hidden_tooltip = {
						FROM = {
							NAND = {
								ai = yes
								is_society_grandmaster = yes
							}
						}
					}
				}
				FROM = { detract_society_currency_tiny_effect = yes }
			}
			if = {
				limit = {
					FROM = {
						ai = yes
						is_society_grandmaster = yes
					}
				}
				FROM = { detract_society_currency_tiny_effect = yes }
			}
			if = {
				limit = {
					is_ruler = yes
					hidden_tooltip = {
						FROM = {
							NAND = {
								ai = yes
								is_society_grandmaster = yes
							}
						}
					}
				}
				FROM = { detract_society_currency_minor_effect = yes }
			}

			hidden_effect = {
				add_character_modifier = {
					name = secret_religion_induction_timer
					years = 10
					hidden = yes
				}
			}

			custom_tooltip = {
				text = secret_religions_induct_character_effect_tt
				FROM = { character_event = { id = MNM.3408 days = 10 } }
			}
			FROM = { 
				if = { 
					limit = {
						is_society_grandmaster = yes
					}
					increase_visibility_minor_effect = yes
				}
				if = {
					limit = {
						NOT = { is_society_grandmaster = yes }
					}
					increase_visibility_effect = yes
				}
			}
		}

		#revoke_allowed = {
			#always = no
		#}
		
		ai_will_do = {
			factor = 1
			modifier = {
				FROM = { has_quest = quest_secret_religious_societies_induct_ruler }
    			is_quest_target_of = FROM
    			factor = 100
			}
			modifier = {
				FROM = { has_quest = quest_secret_religious_societies_induct_ruler }
				NOT = {
					is_quest_target_of = FROM
				}
				factor = 0.01 #to save targets for missions
			}
			modifier = {
				FROM = {
					NOT = { 
						is_society_grandmaster = yes
					}
				}
				factor = 0.1
			}
			modifier = {
				ai = no
				factor = 5
			}
			modifier = {
				is_ruler = yes
				factor = 10
			}
			modifier = {
				is_close_relative = FROM
				factor = 10
			}
			modifier = {
				is_lover = FROM
				factor = 10
			}
			modifier = {
				is_friend = FROM
				factor = 10
			}
			modifier = {
				trait = trusting
				factor = 5
			}
			modifier = {
				NOT = {
					any_realm_character = {
						ai = no
					}
				}
    			factor = 0.01
			}
		}
	}
	
	secret_religions_evoke_sympathy = {
		is_in_society = yes
		
		filter = realm 
		ai_target_filter = realm

		from_potential = {
			society_member_of = secret_religious_cult
			is_adult = yes
			prisoner = no
			NOT = { trait = incapable }
			NOT = { is_inaccessible_trigger = yes }
			OR = { # Performance saving measure
				has_society_currency_tiny_trigger = yes
				ai = no
			}
			OR = {
				ai = no
				is_society_grandmaster = yes
				num_of_society_members < 90
			}
		}

		potential = {
			same_realm = FROM
			is_adult = yes
			NOT = { same_society_as = FROM }
			FROM = { 
				ROOT = { 
					has_sympathy_for_true_religion_of_prev_trigger = no
					is_openly_of_prevs_true_religion_group = no
					shares_prevs_secret_religion_trigger = no
				}
			}
			NOT = { 
				character = FROM
				society = {
					FROM = {
						society = {
							society_type = PREVPREV
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				NOT = {
					has_character_modifier = accused_apostate
				}
				prisoner = no
				is_inaccessible_trigger = no
				NOT = { trait = incapable }
			}
			prisoner = no
			NOT = { trait = incapable }
			NOT = { is_inaccessible_trigger = yes }
			custom_tooltip = {
				text = secret_religions_evoke_sympathy_cd_tt
				OR = {
					NOT = { has_character_modifier = secret_religion_sympathy_timer }
					AND = {
						FROM = {
							has_quest = quest_secret_religious_societies_sympathy_ruler
							ROOT = { is_quest_target_of = FROM }
						}
					}
				}
			}
			FROM = {
				OR = {
					custom_tooltip = {
						text = evoke_sympathy_of_tt
						has_quest = quest_secret_religious_societies_sympathy_ruler
						ROOT = { is_quest_target_of = FROM }
					}
					has_society_currency_tiny_trigger = yes
				}
			}
		}

		effect = {
			if = {
				limit = {
					NOT = {
						AND = {
							FROM = { has_quest = quest_secret_religious_societies_sympathy_ruler }
							ROOT = { is_quest_target_of = FROM }
						}
					}
				}
				FROM = { detract_society_currency_tiny_effect = yes }
			}

			hidden_effect = {
				add_character_modifier = {
					name = secret_religion_sympathy_timer
					years = 10
					hidden = yes
				}
			}

			custom_tooltip = {
				text = secret_religions_evoke_sympathy_tt
				FROM = { character_event = { id = MNM.3404 days = 7 } }
			}
			FROM = {
				if = {
					limit = {
						NOT = { is_society_grandmaster = yes }
					}
					increase_visibility_minor_effect = yes
				}
			}
		}

		#revoke_allowed = {
			#always = no
		#}
		
		ai_will_do = {
			factor = 1
			modifier = {
				FROM = { has_quest = quest_secret_religious_societies_sympathy_ruler }
    			is_quest_target_of = FROM
    			factor = 100
			}
			modifier = {
				FROM = { has_quest = quest_secret_religious_societies_sympathy_ruler }
				NOT = {
					is_quest_target_of = FROM
				}
				factor = 0.01 #to save targets for missions
			}
			modifier = {
				FROM = { has_quest = quest_secret_religious_societies_induct_ruler } #to complete this mission, sympathy is needed first
    			is_quest_target_of = FROM
    			factor = 100
			}
			modifier = {
				FROM = { has_quest = quest_secret_religious_societies_induct_ruler }
    			NOT = {
					is_quest_target_of = FROM
				}
    			factor = 0.01
			}
			modifier = {
				FROM = {
					NOT = { 
						is_society_grandmaster = yes
					}
				}
				factor = 0.1
			}
			modifier = {
				is_ruler = yes
				factor = 3
			}
			modifier = {
				trait = zealous
				factor = 0.0001
			}
			modifier = {
				is_close_relative = FROM
				factor = 10
			}
			modifier = {
				is_lover = FROM
				factor = 10
			}
			modifier = {
				is_friend = FROM
				factor = 10
			}
			modifier = {
				trait = kind
				factor = 5
			}
			modifier = {
				trait = trusting
				factor = 5
			}
			modifier = {
				ai = no
				factor = 5
			}
		}
	}
	
	secret_religions_renounce_secret_religion = {
		only_playable = yes
		
		filter = self
		ai_target_filter = self
		
		potential = {
			character = FROM
			has_secret_religion = yes
		}
		
		allow = {
			NOT = { trait = incapable }
		}
		
		effect = {
			if = {
				limit = {
					society_member_of = secret_religious_cult
					is_society_grandmaster = yes
				}
				leave_society = yes
			}
			clear_secret_religion = yes
		}
		
		#revoke_allowed = {
			#always = no
		#}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	secret_religions_personally_adopt_secret_religion = {
		only_playable = yes
		
		filter = self
		ai_target_filter = self
		
		potential = {
			character = FROM
			has_secret_religion = yes
		}
		
		allow = {
			NOT = { trait = incapable }
		}
		
		effect = {
			flip_to_secret_religion_effect = yes
			trigger_switch = {
				on_trigger = religion
				antinomian = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_antinomian_community } 
						religion = antinomian
					}
				}
				aten = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_aten_community }
						religion = aten
					}
				}	
				batembuzi = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_batembuzi_community }
						religion = batembuzi
					}
				}	
				bud_bahusrutiya = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_bud_bahusrutiya_community }
						religion = bud_bahusrutiya
					}
				}	
				bud_mahayana = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_bud_mahayana_community }
						religion = bud_mahayana
					}
				}	
				cathar = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_cathar_community }
						religion = cathar
					}
				}	
				dionysos = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_dionysos_community }
						religion = dionysos
					}
				}	
				donatist = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_donatist_community }
						religion = donatist
					}
				}	
				druze = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_druze_community }
						religion = druze
					}
				}	
				erlik = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_erlik_community }
						religion = erlik
					}
				}	
				haruri = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_haruri_community }
						religion = haruri
					}
				}	
				hubal = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_hubal_community }
						religion = hubal
					}
				}	
				hurufi = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_hurufi_community }
						religion = hurufi
					}
				}	
				ibadi = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_ibadi_community }
						religion = ibadi
					}
				}	
				iconoclast = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_iconoclast_community }
						religion = iconoclast
					}
				}	
				illuyanka = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_illuyanka_community }
						religion = illuyanka
					}
				}	
				irminsul = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_irminsul_community }
						religion = irminsul
					}
				}	
				jud_sabaoth = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_jud_sabaoth_community }
						religion = jud_sabaoth
					}
				}	
				kharijite = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_kharijite_community }
						religion = kharijite
					}
				}	
				mand_ruha = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_mand_ruha_community }
						religion = mand_ruha
					}
				}	
				mani_ahriman = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_mani_ahriman_community }
						religion = mani_ahriman
					}
				}	
				mazdakism = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_mazdakism_community }
						religion = mazdakism
					}
				}	
				melkite = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_melkite_community }
						religion = melkite
					}
				}	
				montanist = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_montanist_community }
						religion = montanist
					}
				}	
				norse_war = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_norse_war_community }
						religion = norse_war
					}
				}	
				pelagian = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_pelagian_community }
						religion = pelagian
					}
				}	
				plato_christ = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_plato_christ_community }
						religion = plato_christ
					}
				}	
				plato_islam = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_plato_islam_community }
						religion = plato_islam
					}
				}	
				priscillian= {
					any_demesne_province = {
						limit = { has_province_modifier = secret_priscillian_community }
						religion = priscillian
					}
				}	
				qarmatian = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_qarmatian_community }
						religion = qarmatian
					}
				}	
				ragnarok = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_ragnarok_community }
						religion = ragnarok
					}
				}	
				saule = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_saule_community }
						religion = saule
					}
				}	
				saura = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_saura_community }
						religion = saura
					}
				}	
				set = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_set_community }
						religion = set
					}
				}	
				sol_christ = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_sol_christ_community }
						religion = sol_christ
					}
				}	
				sufi = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_sufi_community }
						religion = sufi
					}
				}	
				tengri_ahriman = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_tengri_ahriman_community }
						religion = tengri_ahriman
					}
				}	
				vidharma = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_vidharma_community }
						religion = vidharma
					}
				}	
				yahyanism = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_yahyanism_community }
						religion = yahyanism
					}
				}	
				zor_angra = {
					any_demesne_province = {
						limit = { has_province_modifier = secret_zor_angra_community }
						religion = zor_angra
						
					}
				}
			}
			if = {
				limit = {
					liege = {
						NOT = {
							character = ROOT
						}
					}
				}
				liege = {
					character_event = { id = MNM.3840 }
				}
			}
			hidden_tooltip = {
				set_variable = { which = visibility_value value = 0 }
				remove_character_modifier = highly_suspect
				remove_character_modifier = under_suspicion
			}
		}
		
		#revoke_allowed = {
			#always = no
		#}
		
		ai_will_do = {
			factor = 0
		}
	}
}

#########################################################################################################
################ Secret society title decisions
#########################################################################################################
title_decisions = {
	secret_religions_prepare_grounds = {
		only_playable = yes
		
		ai_target_filter = realm_owned
		filter = realm_owned
		
		from_potential = {
			society_rank > 2
			society_member_of = secret_religious_cult
		}
		
		potential = {
			tier = COUNT
			holder_scope = {
				OR = {
					character = FROM
					any_liege = { character = FROM }
				}
			}
			OR = {
				AND = {
					FROM = {
						society_member_of = secret_religious_society_antinomian
					}
					NOT = { location = { religion = antinomian } }
					NOT = { location = { has_province_modifier = secret_antinomian_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_aten 
					}
					NOT = { location = { religion = aten } }
					NOT = { location = { has_province_modifier = secret_aten_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_batembuzi 
					}
					NOT = { location = { religion = batembuzi } }
					NOT = { location = { has_province_modifier = secret_batembuzi_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_bud_bahusrutiya 
					}
					NOT = { location = { religion = bud_bahusrutiya } }
					NOT = { location = { has_province_modifier = secret_bud_bahusrutiya_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_bud_mahayana 
					}
					NOT = { location = { religion = bud_mahayana } }
					NOT = { location = { has_province_modifier = secret_bud_mahayana_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_cathar 
					}
					NOT = { location = { religion = cathar } }
					NOT = { location = { has_province_modifier = secret_cathar_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_dionysos 
					}
					NOT = { location = { religion = dionysos } }
					NOT = { location = { has_province_modifier = secret_dionysos_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_donatist 
					}
					NOT = { location = { religion = donatist } }
					NOT = { location = { has_province_modifier = secret_donatist_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_druze 
					}
					NOT = { location = { religion = druze } }
					NOT = { location = { has_province_modifier = secret_druze_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_erlik 
					}
					NOT = { location = { religion = erlik } }
					NOT = { location = { has_province_modifier = secret_erlik_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_haruri 
					}
					NOT = { location = { religion = haruri } }
					NOT = { location = { has_province_modifier = secret_haruri_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_hubal 
					}
					NOT = { location = { religion = hubal } }
					NOT = { location = { has_province_modifier = secret_hubal_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_hurufi 
					}
					NOT = { location = { religion = hurufi } }
					NOT = { location = { has_province_modifier = secret_hurufi_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_ibadi 
					}
					NOT = { location = { religion = ibadi } }
					NOT = { location = { has_province_modifier = secret_ibadi_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_iconoclast 
					}
					NOT = { location = { religion = iconoclast } }
					NOT = { location = { has_province_modifier = secret_iconoclast_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_illuyanka 
					}
					NOT = { location = { religion = illuyanka } }
					NOT = { location = { has_province_modifier = secret_illuyanka_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_irminsul 
					}
					NOT = { location = { religion = irminsul } }
					NOT = { location = { has_province_modifier = secret_irminsul_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_jud_sabaoth 
					}
					NOT = { location = { religion = jud_sabaoth } }
					NOT = { location = { has_province_modifier = secret_jud_sabaoth_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_kharijite 
					}
					NOT = { location = { religion = kharijite } }
					NOT = { location = { has_province_modifier = secret_kharijite_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_mand_ruha 
					}
					NOT = { location = { religion = mand_ruha } }
					NOT = { location = { has_province_modifier = secret_mand_ruha_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_mani_ahriman 
					}
					NOT = { location = { religion = mani_ahriman } }
					NOT = { location = { has_province_modifier = secret_mani_ahriman_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_mazdakism 
					}
					NOT = { location = { religion = mazdakism } }
					NOT = { location = { has_province_modifier = secret_mazdakism_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_melkite 
					}
					NOT = { location = { religion = melkite } }
					NOT = { location = { has_province_modifier = secret_melkite_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_montanist 
					}
					NOT = { location = { religion = montanist } }
					NOT = { location = { has_province_modifier = secret_montanist_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_norse_war 
					}
					NOT = { location = { religion = norse_war } }
					NOT = { location = { has_province_modifier = secret_norse_war_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_pelagian 
					}
					NOT = { location = { religion = pelagian } }
					NOT = { location = { has_province_modifier = secret_pelagian_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_plato_christ 
					}
					NOT = { location = { religion = plato_christ } }
					NOT = { location = { has_province_modifier = secret_plato_christ_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_plato_islam 
					}
					NOT = { location = { religion = plato_islam } }
					NOT = { location = { has_province_modifier = secret_plato_islam_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_priscillian
					}
					NOT = { location = { religion = priscillian } }
					NOT = { location = { has_province_modifier = secret_priscillian_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_qarmatian 
					}
					NOT = { location = { religion = qarmatian } }
					NOT = { location = { has_province_modifier = secret_qarmatian_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_ragnarok 
					}
					NOT = { location = { religion = ragnarok } }
					NOT = { location = { has_province_modifier = secret_ragnarok_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_saule 
					}
					NOT = { location = { religion = saule } }
					NOT = { location = { has_province_modifier = secret_saule_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_saura 
					}
					NOT = { location = { religion = saura } }
					NOT = { location = { has_province_modifier = secret_saura_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_set 
					}
					NOT = { location = { religion = set } }
					NOT = { location = { has_province_modifier = secret_set_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_sol_christ 
					}
					NOT = { location = { religion = sol_christ } }
					NOT = { location = { has_province_modifier = secret_sol_christ_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_sufi 
					}
					NOT = { location = { religion = sufi } }
					NOT = { location = { has_province_modifier = secret_sufi_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_tengri_ahriman 
					}
					NOT = { location = { religion = tengri_ahriman } }
					NOT = { location = { has_province_modifier = secret_tengri_ahriman_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_vidharma 
					}
					NOT = { location = { religion = vidharma } }
					NOT = { location = { has_province_modifier = secret_vidharma_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_yahyanism 
					}
					NOT = { location = { religion = yahyanism } }
					NOT = { location = { has_province_modifier = secret_yahyanism_community } }
				}
				AND = {
					FROM = {
						society_member_of = secret_religious_society_zor_angra 
					}
					NOT = { location = { religion = zor_angra } }
					NOT = { location = { has_province_modifier = secret_zor_angra_community } }
				}
			}
		}
		
		allow = {
			FROM = {
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				has_society_currency_medium_trigger = yes
			}
			custom_tooltip = {
				text = prepare_grounds_allow_tooltip
				hidden_trigger = {	
					location = {
						ROOT_FROM = { 
							NOT = { has_character_flag = preparing_grounds_in_@PREV }
						}
					}
				}
			}
		}
		
		effect = {
			location = {
				save_event_target_as = target_province
			}
			FROM = {
				society = {
					save_event_target_as = original_society
				}
				if = {
					limit = { 
						ai = no
					}
					detract_society_currency_medium_effect = yes
				}
				custom_tooltip = {
					text = secret_religions_prepare_grounds_effect_tooltip
					character_event = { id = MNM.3850 days = 2 }
				}
			}
			FROM = { 
				if = { 
					limit = {
						is_society_grandmaster = yes
					}
					increase_visibility_minor_effect = yes
				}
				if = {
					limit = {
						NOT = { is_society_grandmaster = yes }
					}
					increase_visibility_effect = yes
				}
				set_character_flag = preparing_grounds_in_@event_target:target_province
				character_event = { id = MNM.3849 days = 1200 }
			}
		}
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
			}
		}
	}
}

#########################################################################################################
################ Secret society normal decisions
#########################################################################################################
decisions = {
	secret_religions_found_secret_religious_society = {
		only_playable = yes
		
		is_high_prio = yes
	
		potential = {
			has_secret_religion = yes
			secret_religious_cult = { # Has no members
				NOT = {
					any_society_member = { always = yes }
				}
			}
			NOT = {
				has_game_rule = {
					name = secret_cults
					value = none
				}
			}
		}
		
		allow = {
			is_adult = yes
			prestige = 250
			NOT = { is_in_society = yes }
			prisoner = no
			NOT = { trait = incapable }
			NOT = { is_inaccessible_trigger = yes }
		}
		
		effect = {
#			hidden_effect = { # To track the number of Founded Cults
#				change_variable = { which = global_founded_cults value = 1 }
#				if = {
#					limit = {
#						secret_religion = antinomian
#					}
#					change_variable = { which = global_antinomian_founded_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = antinomian
#						}
#						change_variable = { which = global_antinomian_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = aten
#						}
#						change_variable = { which = global_aten_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = batembuzi
#						}
#						change_variable = { which = global_batembuzi_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = bud_bahusrutiya
#						}
#						change_variable = { which = global_bud_bahusrutiya_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = bud_mahayana
#						}
#						change_variable = { which = global_bud_mahayana_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = cathar
#						}
#						change_variable = { which = global_cathar_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = dionysos
#						}
#						change_variable = { which = global_dionysos_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = donatist
#						}
#						change_variable = { which = global_donatist_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = druze
#						}
#						change_variable = { which = global_druze_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = erlik
#						}
#						change_variable = { which = global_erlik_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = haruri
#						}
#						change_variable = { which = global_haruri_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = hubal
#						}
#						change_variable = { which = global_hubal_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = hurufi
#						}
#						change_variable = { which = global_hurufi_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = ibadi
#						}
#						change_variable = { which = global_ibadi_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = iconoclast
#						}
#						change_variable = { which = global_iconoclast_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = illuyanka
#						}
#						change_variable = { which = global_illuyanka_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = irminsul
#						}
#						change_variable = { which = global_irminsul_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = jud_sabaoth
#						}
#						change_variable = { which = global_jud_sabaoth_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = kharijite
#						}
#						change_variable = { which = global_kharijite_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = mand_ruha
#						}
#						change_variable = { which = global_mand_ruha_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = mani_ahriman
#						}
#						change_variable = { which = global_mani_ahriman_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = mazdakism
#						}
#						change_variable = { which = global_mazdakism_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = melkite
#						}
#						change_variable = { which = global_melkite_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = montanist
#						}
#						change_variable = { which = global_montanist_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = norse_war
#						}
#						change_variable = { which = global_norse_war_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = pelagian
#						}
#						change_variable = { which = global_pelagian_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = plato_christ
#						}
#						change_variable = { which = global_plato_christ_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = plato_islam
#						}
#						change_variable = { which = global_plato_islam_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = priscillian
#						}
#						change_variable = { which = global_priscillian_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = qarmatian
#						}
#						change_variable = { which = global_qarmatian_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = ragnarok
#						}
#						change_variable = { which = global_ragnarok_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = saule
#						}
#						change_variable = { which = global_saule_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = saura
#						}
#						change_variable = { which = global_saura_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = set
#						}
#						change_variable = { which = global_set_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = sol_christ
#						}
#						change_variable = { which = global_sol_christ_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = sufi
#						}
#						change_variable = { which = global_sufi_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = tengri_ahriman
#						}
#						change_variable = { which = global_tengri_ahriman_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = vidharma
#						}
#						change_variable = { which = global_vidharma_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = yahyanism
#						}
#						change_variable = { which = global_yahyanism_revealed_cults value = 1 }
#				}
#				if = {
#						limit = {
#							secret_religion = zor_angra
#						}
#						change_variable = { which = global_zor_angra
#					}
#				}
			character_event = { id = MNM.3950 }
			prestige = -250
			join_society = secret_religious_cult
			set_society_grandmaster = yes # Set character as Grand Master
			add_society_currency_massive_effect = yes # Give the Grand Master a start-up capital to induct members
		}
		
		#revoke_allowed = {
			#always = no
		#}
		
		ai_will_do = {
			factor = 0.1
			
			modifier = {
				factor = 0.03 # Slow down
			}
			modifier = {
				factor = 2
				OR = {
					top_liege = { # If the characters top liege is a player
						ai = no
					}
					top_liege = {
						any_realm_lord = { # If there is a player vassal in the same realm that is not secretly religious
							ai = no
							independent = no
							has_secret_religion_trait_trigger = no
						}
					}
				}
			}
			modifier = {
				factor = 0.1
				NOT = {
					trait = zealous
				}
			}
			modifier = {
				factor = 0.1
				OR = {
					trait = content
					trait = trusting
					trait = shy
				}
			}
			modifier = { # Do not create more than one society per realm
				factor = 0
				any_realm_lord = {
					society_member_of = secret_religious_cult
				}
			}
			modifier = {
				factor = 0
				any_player = {
					shares_prevs_secret_religion_trigger = yes
				}
			}
		}
	}
	
	secret_religions_falsely_confess_faith = {
	
		is_high_prio = yes
	
		only_playable = yes
		
		potential = {
			OR = {
				liege = {
					NOT = {
						religion = ROOT
					}
				}
				top_liege = {
					NOT = {
						religion = ROOT
					}
				}
			}
			NOT = { controls_religion = yes }
		}
		allow = {
			piety = 100
			prisoner = no
			NOT = { trait = incapable }
			NOT = { is_inaccessible_trigger = yes }
		}
		effect = {
			character_event = { id = MNM.3951 days = 1 }
			if = {
				limit = { has_secret_religion = yes }
				secret_religion_scope = { save_event_target_as = actual_religion }
				piety = -50
				custom_tooltip = { text = confess_faith_already_has_secret_rel_tt }
			}
			else = {
				religion_scope = { save_event_target_as = actual_religion }
				piety = -100
				tooltip = {
					set_secret_religion = event_target:actual_religion # This has to actually happen after the religion is set
				}
			}
			custom_tooltip = {
				text = confess_faith_decision_tooltip
				hidden_effect = {
					if = {
						limit = {
							liege = {
								NOT = {
									religion = ROOT
								}
							}
						}
						liege = {
							religion_scope = { save_event_target_as = false_religion }
						}
					}
					else_if = {
						limit = {
							top_liege = {
								NOT = {
									religion = ROOT
								}
							}
						}
						top_liege = {
							religion_scope = { save_event_target_as = false_religion }
						}
					}
					ROOT = {
						religion = event_target:false_religion
						set_secret_religion = event_target:actual_religion
					}
				}
			}
			custom_tooltip = {
				text = confess_faith_courtiers_decision_tooltip
				hidden_effect = {
					any_courtier = {
						limit = {
							religion = event_target:actual_religion
							employer = { character = ROOT }
							NOT = { trait = zealous }
							NOT = { has_secret_religion = yes }
						}
						random = {
							chance = 50
							modifier = {
								factor = 1.5
								is_close_relative = yes
							}
							modifier = {
								factor = 1.2
								trait = cynical
							}
							religion = event_target:false_religion
							set_secret_religion = event_target:actual_religion
						}
					}
				}
			}
		}
		#revoke_allowed = {
			#always = no
		#}
		
		ai_will_do = {
			factor = 0
		}
	}
}

title_decisions = {
	secretly_convert_to_province_religion = {
		filter = owned
		ai_target_filter = self
		
		only_playable = yes
		
		from_potential = {
			ai = no
			NOT = { controls_religion = yes }
		}
		
		potential = {
			tier = COUNT
			NOT = { location = { religion = FROM } }
			NOT = { location = { religion = { target_type = secret target = FROM } } }
			owner = { character = FROM }
		}
		
		allow = {
			FROM = { 
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}
		
		effect = {
			location = { save_event_target_as = location }
			FROM = {
				set_secret_religion = event_target:location
				piety = -250
			}
		}
		
		#revoke_allowed = {
			#always = no
		#}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	secretly_convert_to_antinomian_holy_site = {
		filter = owned
		ai_target_filter = self
	
		only_playable = yes
		
		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { secret_religion = antinomian }
			NOT = { religion = antinomian }
			NOT = { controls_religion = yes }
		}
		
		potential = {
			tier = COUNT
			NOT = {
				location = { religion = antinomian }
			}
			OR = {
				is_holy_site = antinomian
				any_de_jure_vassal_title = {
					is_holy_site = antinomian
				}
			}
			OR = {
				holder_scope = {
					character = FROM
				}
				AND = {
					tier = BARON
					holder_scope = {
						liege = {
							character = FROM
						}
					}
				}
			}
		}
		
		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}
		
		effect = {
			FROM = {
				piety = -250
				set_secret_religion = antinomian
			}
		}
		
		#revoke_allowed = {
			#always = no
		#}
		
		ai_will_do = {
			factor = 0
		}
	}
	secretly_convert_to_aten_holy_site = {
		filter = owned
		ai_target_filter = self

		only_playable = yes

		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { secret_religion = aten }
			NOT = { religion = aten }
			NOT = { controls_religion = yes }
		}

		potential = {
			tier = COUNT
			NOT = {
				location = { religion = aten }
			}
			OR = {
				is_holy_site = aten
				any_de_jure_vassal_title = {
					is_holy_site = aten
											}
			}
			OR = {
				holder_scope = {
					character = FROM
				}
				AND = {
					tier = BARON
					holder_scope = {
						liege = {
							character = FROM
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			FROM = {
				piety = -250
				set_secret_religion = aten
			}
		}
		#revoke_allowed = {
			#always = no
		#}

		ai_will_do = {
			factor = 0
		}
	}
	secretly_convert_to_batembuzi_holy_site = {
		filter = owned
		ai_target_filter = self

		only_playable = yes

		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { secret_religion = batembuzi }
			NOT = { religion = batembuzi }
			NOT = { controls_religion = yes }
		}

		potential = {
			tier = COUNT
			NOT = {
				location = { religion = batembuzi }
			}
			OR = {
				is_holy_site = batembuzi
				any_de_jure_vassal_title = {
					is_holy_site = batembuzi
											}
			}
			OR = {
				holder_scope = {
					character = FROM
				}
				AND = {
					tier = BARON
					holder_scope = {
						liege = {
							character = FROM
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			FROM = {
				piety = -250
				set_secret_religion = batembuzi
			}
		}
		#revoke_allowed = {
			#always = no
		#}

		ai_will_do = {
			factor = 0
		}
	}
	secretly_convert_to_bud_bahusrutiya_holy_site = {
		filter = owned
		ai_target_filter = self

		only_playable = yes

		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { secret_religion = bud_bahusrutiya }
			NOT = { religion = bud_bahusrutiya }
			NOT = { controls_religion = yes }
		}

		potential = {
			tier = COUNT
			NOT = {
				location = { religion = bud_bahusrutiya }
			}
			OR = {
				is_holy_site = bud_bahusrutiya
				any_de_jure_vassal_title = {
					is_holy_site = bud_bahusrutiya
											}
			}
			OR = {
				holder_scope = {
					character = FROM
				}
				AND = {
					tier = BARON
					holder_scope = {
						liege = {
							character = FROM
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			FROM = {
				piety = -250
				set_secret_religion = bud_bahusrutiya
			}
		}
		#revoke_allowed = {
			#always = no
		#}

		ai_will_do = {
			factor = 0
		}
	}
	secretly_convert_to_bud_mahayana_holy_site = {
		filter = owned
		ai_target_filter = self

		only_playable = yes

		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { secret_religion = bud_mahayana }
			NOT = { religion = bud_mahayana }
			NOT = { controls_religion = yes }
		}

		potential = {
			tier = COUNT
			NOT = {
				location = { religion = bud_mahayana }
			}
			OR = {
				is_holy_site = bud_mahayana
				any_de_jure_vassal_title = {
					is_holy_site = bud_mahayana
											}
			}
			OR = {
				holder_scope = {
					character = FROM
				}
				AND = {
					tier = BARON
					holder_scope = {
						liege = {
							character = FROM
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			FROM = {
				piety = -250
				set_secret_religion = bud_mahayana
			}
		}
		#revoke_allowed = {
			#always = no
		#}

		ai_will_do = {
			factor = 0
		}
	}
	secretly_convert_to_cathar_holy_site = {
		filter = owned
		ai_target_filter = self

		only_playable = yes

		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { secret_religion = cathar }
			NOT = { religion = cathar }
			NOT = { controls_religion = yes }
		}

		potential = {
			tier = COUNT
			NOT = {
				location = { religion = cathar }
			}
			OR = {
				is_holy_site = cathar
				any_de_jure_vassal_title = {
					is_holy_site = cathar
											}
			}
			OR = {
				holder_scope = {
					character = FROM
				}
				AND = {
					tier = BARON
					holder_scope = {
						liege = {
							character = FROM
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			FROM = {
				piety = -250
				set_secret_religion = cathar
			}
		}
		#revoke_allowed = {
			#always = no
		#}

		ai_will_do = {
			factor = 0
		}
	}
	secretly_convert_to_dionysos_holy_site = {
		filter = owned
		ai_target_filter = self

		only_playable = yes

		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { secret_religion = dionysos }
			NOT = { religion = dionysos }
			NOT = { controls_religion = yes }
		}

		potential = {
			tier = COUNT
			NOT = {
				location = { religion = dionysos }
			}
			OR = {
				is_holy_site = dionysos
				any_de_jure_vassal_title = {
					is_holy_site = dionysos
											}
			}
			OR = {
				holder_scope = {
					character = FROM
				}
				AND = {
					tier = BARON
					holder_scope = {
						liege = {
							character = FROM
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			FROM = {
				piety = -250
				set_secret_religion = dionysos
			}
		}
		#revoke_allowed = {
			#always = no
		#}

		ai_will_do = {
			factor = 0
		}
	}
	secretly_convert_to_donatist_holy_site = {
		filter = owned
		ai_target_filter = self

		only_playable = yes

		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { secret_religion = donatist }
			NOT = { religion = donatist }
			NOT = { controls_religion = yes }
		}

		potential = {
			tier = COUNT
			NOT = {
				location = { religion = donatist }
			}
			OR = {
				is_holy_site = donatist
				any_de_jure_vassal_title = {
					is_holy_site = donatist
											}
			}
			OR = {
				holder_scope = {
					character = FROM
				}
				AND = {
					tier = BARON
					holder_scope = {
						liege = {
							character = FROM
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			FROM = {
				piety = -250
				set_secret_religion = donatist
			}
		}
		#revoke_allowed = {
			#always = no
		#}

		ai_will_do = {
			factor = 0
		}
	}
	secretly_convert_to_druze_holy_site = {
		filter = owned
		ai_target_filter = self

		only_playable = yes

		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { secret_religion = druze }
			NOT = { religion = druze }
			NOT = { controls_religion = yes }
		}

		potential = {
			tier = COUNT
			NOT = {
				location = { religion = druze }
			}
			OR = {
				is_holy_site = druze
				any_de_jure_vassal_title = {
					is_holy_site = druze
											}
			}
			OR = {
				holder_scope = {
					character = FROM
				}
				AND = {
					tier = BARON
					holder_scope = {
						liege = {
							character = FROM
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			FROM = {
				piety = -250
				set_secret_religion = druze
			}
		}
		#revoke_allowed = {
			#always = no
		#}

		ai_will_do = {
			factor = 0
		}
	}
	secretly_convert_to_erlik_holy_site = {
		filter = owned
		ai_target_filter = self

		only_playable = yes

		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { secret_religion = erlik }
			NOT = { religion = erlik }
			NOT = { controls_religion = yes }
		}

		potential = {
			tier = COUNT
			NOT = {
				location = { religion = erlik }
			}
			OR = {
				is_holy_site = erlik
				any_de_jure_vassal_title = {
					is_holy_site = erlik
											}
			}
			OR = {
				holder_scope = {
					character = FROM
				}
				AND = {
					tier = BARON
					holder_scope = {
						liege = {
							character = FROM
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			FROM = {
				piety = -250
				set_secret_religion = erlik
			}
		}
		#revoke_allowed = {
			#always = no
		#}

		ai_will_do = {
			factor = 0
		}
	}
	secretly_convert_to_haruri_holy_site = {
		filter = owned
		ai_target_filter = self

		only_playable = yes

		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { secret_religion = haruri }
			NOT = { religion = haruri }
			NOT = { controls_religion = yes }
		}

		potential = {
			tier = COUNT
			NOT = {
				location = { religion = haruri }
			}
			OR = {
				is_holy_site = haruri
				any_de_jure_vassal_title = {
					is_holy_site = haruri
											}
			}
			OR = {
				holder_scope = {
					character = FROM
				}
				AND = {
					tier = BARON
					holder_scope = {
						liege = {
							character = FROM
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			FROM = {
				piety = -250
				set_secret_religion = haruri
			}
		}
		#revoke_allowed = {
			#always = no
		#}

		ai_will_do = {
			factor = 0
		}
	}
	secretly_convert_to_hubal_holy_site = {
		filter = owned
		ai_target_filter = self

		only_playable = yes

		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { secret_religion = hubal }
			NOT = { religion = hubal }
			NOT = { controls_religion = yes }
		}

		potential = {
			tier = COUNT
			NOT = {
				location = { religion = hubal }
			}
			OR = {
				is_holy_site = hubal
				any_de_jure_vassal_title = {
					is_holy_site = hubal
											}
			}
			OR = {
				holder_scope = {
					character = FROM
				}
				AND = {
					tier = BARON
					holder_scope = {
						liege = {
							character = FROM
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			FROM = {
				piety = -250
				set_secret_religion = hubal
			}
		}
		#revoke_allowed = {
			#always = no
		#}

		ai_will_do = {
			factor = 0
		}
	}
	secretly_convert_to_hurufi_holy_site = {
		filter = owned
		ai_target_filter = self

		only_playable = yes

		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { secret_religion = hurufi }
			NOT = { religion = hurufi }
			NOT = { controls_religion = yes }
		}

		potential = {
			tier = COUNT
			NOT = {
				location = { religion = hurufi }
			}
			OR = {
				is_holy_site = hurufi
				any_de_jure_vassal_title = {
					is_holy_site = hurufi
											}
			}
			OR = {
				holder_scope = {
					character = FROM
				}
				AND = {
					tier = BARON
					holder_scope = {
						liege = {
							character = FROM
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			FROM = {
				piety = -250
				set_secret_religion = hurufi
			}
		}
		#revoke_allowed = {
			#always = no
		#}

		ai_will_do = {
			factor = 0
		}
	}
	secretly_convert_to_ibadi_holy_site = {
		filter = owned
		ai_target_filter = self

		only_playable = yes

		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { secret_religion = ibadi }
			NOT = { religion = ibadi }
			NOT = { controls_religion = yes }
		}

		potential = {
			tier = COUNT
			NOT = {
				location = { religion = ibadi }
			}
			OR = {
				is_holy_site = ibadi
				any_de_jure_vassal_title = {
					is_holy_site = ibadi
											}
			}
			OR = {
				holder_scope = {
					character = FROM
				}
				AND = {
					tier = BARON
					holder_scope = {
						liege = {
							character = FROM
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			FROM = {
				piety = -250
				set_secret_religion = ibadi
			}
		}
		#revoke_allowed = {
			#always = no
		#}

		ai_will_do = {
			factor = 0
		}
	}
	secretly_convert_to_iconoclast_holy_site = {
		filter = owned
		ai_target_filter = self

		only_playable = yes

		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { secret_religion = iconoclast }
			NOT = { religion = iconoclast }
			NOT = { controls_religion = yes }
		}

		potential = {
			tier = COUNT
			NOT = {
				location = { religion = iconoclast }
			}
			OR = {
				is_holy_site = iconoclast
				any_de_jure_vassal_title = {
					is_holy_site = iconoclast
											}
			}
			OR = {
				holder_scope = {
					character = FROM
				}
				AND = {
					tier = BARON
					holder_scope = {
						liege = {
							character = FROM
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			FROM = {
				piety = -250
				set_secret_religion = iconoclast
			}
		}
		#revoke_allowed = {
			#always = no
		#}

		ai_will_do = {
			factor = 0
		}
	}
	secretly_convert_to_illuyanka_holy_site = {
		filter = owned
		ai_target_filter = self

		only_playable = yes

		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { secret_religion = illuyanka }
			NOT = { religion = illuyanka }
			NOT = { controls_religion = yes }
		}

		potential = {
			tier = COUNT
			NOT = {
				location = { religion = illuyanka }
			}
			OR = {
				is_holy_site = illuyanka
				any_de_jure_vassal_title = {
					is_holy_site = illuyanka
											}
			}
			OR = {
				holder_scope = {
					character = FROM
				}
				AND = {
					tier = BARON
					holder_scope = {
						liege = {
							character = FROM
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			FROM = {
				piety = -250
				set_secret_religion = illuyanka
			}
		}
		#revoke_allowed = {
			#always = no
		#}

		ai_will_do = {
			factor = 0
		}
	}
	secretly_convert_to_irminsul_holy_site = {
		filter = owned
		ai_target_filter = self

		only_playable = yes

		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { secret_religion = irminsul }
			NOT = { religion = irminsul }
			NOT = { controls_religion = yes }
		}

		potential = {
			tier = COUNT
			NOT = {
				location = { religion = irminsul }
			}
			OR = {
				is_holy_site = irminsul
				any_de_jure_vassal_title = {
					is_holy_site = irminsul
											}
			}
			OR = {
				holder_scope = {
					character = FROM
				}
				AND = {
					tier = BARON
					holder_scope = {
						liege = {
							character = FROM
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			FROM = {
				piety = -250
				set_secret_religion = irminsul
			}
		}
		#revoke_allowed = {
			#always = no
		#}

		ai_will_do = {
			factor = 0
		}
	}
	secretly_convert_to_jud_sabaoth_holy_site = {
		filter = owned
		ai_target_filter = self

		only_playable = yes

		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { secret_religion = jud_sabaoth }
			NOT = { religion = jud_sabaoth }
			NOT = { controls_religion = yes }
		}

		potential = {
			tier = COUNT
			NOT = {
				location = { religion = jud_sabaoth }
			}
			OR = {
				is_holy_site = jud_sabaoth
				any_de_jure_vassal_title = {
					is_holy_site = jud_sabaoth
											}
			}
			OR = {
				holder_scope = {
					character = FROM
				}
				AND = {
					tier = BARON
					holder_scope = {
						liege = {
							character = FROM
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			FROM = {
				piety = -250
				set_secret_religion = jud_sabaoth
			}
		}
		#revoke_allowed = {
			#always = no
		#}

		ai_will_do = {
			factor = 0
		}
	}
	secretly_convert_to_kharijite_holy_site = {
		filter = owned
		ai_target_filter = self

		only_playable = yes

		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { secret_religion = kharijite }
			NOT = { religion = kharijite }
			NOT = { controls_religion = yes }
		}

		potential = {
			tier = COUNT
			NOT = {
				location = { religion = kharijite }
			}
			OR = {
				is_holy_site = kharijite
				any_de_jure_vassal_title = {
					is_holy_site = kharijite
											}
			}
			OR = {
				holder_scope = {
					character = FROM
				}
				AND = {
					tier = BARON
					holder_scope = {
						liege = {
							character = FROM
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			FROM = {
				piety = -250
				set_secret_religion = kharijite
			}
		}
		#revoke_allowed = {
			#always = no
		#}

		ai_will_do = {
			factor = 0
		}
	}
	secretly_convert_to_mand_ruha_holy_site = {
		filter = owned
		ai_target_filter = self

		only_playable = yes

		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { secret_religion = mand_ruha }
			NOT = { religion = mand_ruha }
			NOT = { controls_religion = yes }
		}

		potential = {
			tier = COUNT
			NOT = {
				location = { religion = mand_ruha }
			}
			OR = {
				is_holy_site = mand_ruha
				any_de_jure_vassal_title = {
					is_holy_site = mand_ruha
											}
			}
			OR = {
				holder_scope = {
					character = FROM
				}
				AND = {
					tier = BARON
					holder_scope = {
						liege = {
							character = FROM
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			FROM = {
				piety = -250
				set_secret_religion = mand_ruha
			}
		}
		#revoke_allowed = {
			#always = no
		#}

		ai_will_do = {
			factor = 0
		}
	}
	secretly_convert_to_mani_ahriman_holy_site = {
		filter = owned
		ai_target_filter = self

		only_playable = yes

		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { secret_religion = mani_ahriman }
			NOT = { religion = mani_ahriman }
			NOT = { controls_religion = yes }
		}

		potential = {
			tier = COUNT
			NOT = {
				location = { religion = mani_ahriman }
			}
			OR = {
				is_holy_site = mani_ahriman
				any_de_jure_vassal_title = {
					is_holy_site = mani_ahriman
											}
			}
			OR = {
				holder_scope = {
					character = FROM
				}
				AND = {
					tier = BARON
					holder_scope = {
						liege = {
							character = FROM
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			FROM = {
				piety = -250
				set_secret_religion = mani_ahriman
			}
		}
		#revoke_allowed = {
			#always = no
		#}

		ai_will_do = {
			factor = 0
		}
	}
	secretly_convert_to_mazdakism_holy_site = {
		filter = owned
		ai_target_filter = self

		only_playable = yes

		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { secret_religion = mazdakism }
			NOT = { religion = mazdakism }
			NOT = { controls_religion = yes }
		}

		potential = {
			tier = COUNT
			NOT = {
				location = { religion = mazdakism }
			}
			OR = {
				is_holy_site = mazdakism
				any_de_jure_vassal_title = {
					is_holy_site = mazdakism
											}
			}
			OR = {
				holder_scope = {
					character = FROM
				}
				AND = {
					tier = BARON
					holder_scope = {
						liege = {
							character = FROM
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			FROM = {
				piety = -250
				set_secret_religion = mazdakism
			}
		}
		#revoke_allowed = {
			#always = no
		#}

		ai_will_do = {
			factor = 0
		}
	}
	secretly_convert_to_melkite_holy_site = {
		filter = owned
		ai_target_filter = self

		only_playable = yes

		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { secret_religion = melkite }
			NOT = { religion = melkite }
			NOT = { controls_religion = yes }
		}

		potential = {
			tier = COUNT
			NOT = {
				location = { religion = melkite }
			}
			OR = {
				is_holy_site = melkite
				any_de_jure_vassal_title = {
					is_holy_site = melkite
											}
			}
			OR = {
				holder_scope = {
					character = FROM
				}
				AND = {
					tier = BARON
					holder_scope = {
						liege = {
							character = FROM
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			FROM = {
				piety = -250
				set_secret_religion = melkite
			}
		}
		#revoke_allowed = {
			#always = no
		#}

		ai_will_do = {
			factor = 0
		}
	}
	secretly_convert_to_montanist_holy_site = {
		filter = owned
		ai_target_filter = self

		only_playable = yes

		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { secret_religion = montanist }
			NOT = { religion = montanist }
			NOT = { controls_religion = yes }
		}

		potential = {
			tier = COUNT
			NOT = {
				location = { religion = montanist }
			}
			OR = {
				is_holy_site = montanist
				any_de_jure_vassal_title = {
					is_holy_site = montanist
											}
			}
			OR = {
				holder_scope = {
					character = FROM
				}
				AND = {
					tier = BARON
					holder_scope = {
						liege = {
							character = FROM
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			FROM = {
				piety = -250
				set_secret_religion = montanist
			}
		}
		#revoke_allowed = {
			#always = no
		#}

		ai_will_do = {
			factor = 0
		}
	}
	secretly_convert_to_norse_war_holy_site = {
		filter = owned
		ai_target_filter = self

		only_playable = yes

		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { secret_religion = norse_war }
			NOT = { religion = norse_war }
			NOT = { controls_religion = yes }
		}

		potential = {
			tier = COUNT
			NOT = {
				location = { religion = norse_war }
			}
			OR = {
				is_holy_site = norse_war
				any_de_jure_vassal_title = {
					is_holy_site = norse_war
											}
			}
			OR = {
				holder_scope = {
					character = FROM
				}
				AND = {
					tier = BARON
					holder_scope = {
						liege = {
							character = FROM
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			FROM = {
				piety = -250
				set_secret_religion = norse_war
			}
		}
		#revoke_allowed = {
			#always = no
		#}

		ai_will_do = {
			factor = 0
		}
	}
	secretly_convert_to_pelagian_holy_site = {
		filter = owned
		ai_target_filter = self

		only_playable = yes

		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { secret_religion = pelagian }
			NOT = { religion = pelagian }
			NOT = { controls_religion = yes }
		}

		potential = {
			tier = COUNT
			NOT = {
				location = { religion = pelagian }
			}
			OR = {
				is_holy_site = pelagian
				any_de_jure_vassal_title = {
					is_holy_site = pelagian
											}
			}
			OR = {
				holder_scope = {
					character = FROM
				}
				AND = {
					tier = BARON
					holder_scope = {
						liege = {
							character = FROM
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			FROM = {
				piety = -250
				set_secret_religion = pelagian
			}
		}
		#revoke_allowed = {
			#always = no
		#}

		ai_will_do = {
			factor = 0
		}
	}
	secretly_convert_to_plato_christ_holy_site = {
		filter = owned
		ai_target_filter = self

		only_playable = yes

		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { secret_religion = plato_christ }
			NOT = { religion = plato_christ }
			NOT = { controls_religion = yes }
		}

		potential = {
			tier = COUNT
			NOT = {
				location = { religion = plato_christ }
			}
			OR = {
				is_holy_site = plato_christ
				any_de_jure_vassal_title = {
					is_holy_site = plato_christ
											}
			}
			OR = {
				holder_scope = {
					character = FROM
				}
				AND = {
					tier = BARON
					holder_scope = {
						liege = {
							character = FROM
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			FROM = {
				piety = -250
				set_secret_religion = plato_christ
			}
		}
		#revoke_allowed = {
			#always = no
		#}

		ai_will_do = {
			factor = 0
		}
	}
	secretly_convert_to_plato_islam_holy_site = {
		filter = owned
		ai_target_filter = self

		only_playable = yes

		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { secret_religion = plato_islam }
			NOT = { religion = plato_islam }
			NOT = { controls_religion = yes }
		}

		potential = {
			tier = COUNT
			NOT = {
				location = { religion = plato_islam }
			}
			OR = {
				is_holy_site = plato_islam
				any_de_jure_vassal_title = {
					is_holy_site = plato_islam
											}
			}
			OR = {
				holder_scope = {
					character = FROM
				}
				AND = {
					tier = BARON
					holder_scope = {
						liege = {
							character = FROM
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			FROM = {
				piety = -250
				set_secret_religion = plato_islam
			}
		}
		#revoke_allowed = {
			#always = no
		#}

		ai_will_do = {
			factor = 0
		}
	}
	secretly_convert_to_priscillian_holy_site = {
		filter = owned
		ai_target_filter = self

		only_playable = yes

		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { secret_religion = priscillian }
			NOT = { religion = priscillian }
			NOT = { controls_religion = yes }
		}

		potential = {
			tier = COUNT
			NOT = {
				location = { religion = priscillian }
			}
			OR = {
				is_holy_site = priscillian				
				any_de_jure_vassal_title = {
					is_holy_site = priscillian
				}
			}
			OR = {
				holder_scope = {
					character = FROM
				}
				AND = {
					tier = BARON
					holder_scope = {
						liege = {
							character = FROM
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			FROM = {
				piety = -250
				set_secret_religion = priscillian
			}
		}
		#revoke_allowed = {
			#always = no
		#}

		ai_will_do = {
			factor = 0
		}
	}
	secretly_convert_to_qarmatian_holy_site = {
		filter = owned
		ai_target_filter = self

		only_playable = yes

		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { secret_religion = qarmatian }
			NOT = { religion = qarmatian }
			NOT = { controls_religion = yes }
		}

		potential = {
			tier = COUNT
			NOT = {
				location = { religion = qarmatian }
			}
			OR = {
				is_holy_site = qarmatian
				any_de_jure_vassal_title = {
					is_holy_site = qarmatian
											}
			}
			OR = {
				holder_scope = {
					character = FROM
				}
				AND = {
					tier = BARON
					holder_scope = {
						liege = {
							character = FROM
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			FROM = {
				piety = -250
				set_secret_religion = qarmatian
			}
		}
		#revoke_allowed = {
			#always = no
		#}

		ai_will_do = {
			factor = 0
		}
	}
	secretly_convert_to_ragnarok_holy_site = {
		filter = owned
		ai_target_filter = self

		only_playable = yes

		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { secret_religion = ragnarok }
			NOT = { religion = ragnarok }
			NOT = { controls_religion = yes }
		}

		potential = {
			tier = COUNT
			NOT = {
				location = { religion = ragnarok }
			}
			OR = {
				is_holy_site = ragnarok
				any_de_jure_vassal_title = {
					is_holy_site = ragnarok
											}
			}
			OR = {
				holder_scope = {
					character = FROM
				}
				AND = {
					tier = BARON
					holder_scope = {
						liege = {
							character = FROM
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			FROM = {
				piety = -250
				set_secret_religion = ragnarok
			}
		}
		#revoke_allowed = {
			#always = no
		#}

		ai_will_do = {
			factor = 0
		}
	}
	secretly_convert_to_saule_holy_site = {
		filter = owned
		ai_target_filter = self

		only_playable = yes

		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { secret_religion = saule }
			NOT = { religion = saule }
			NOT = { controls_religion = yes }
		}

		potential = {
			tier = COUNT
			NOT = {
				location = { religion = saule }
			}
			OR = {
				is_holy_site = saule
				any_de_jure_vassal_title = {
					is_holy_site = saule
											}
			}
			OR = {
				holder_scope = {
					character = FROM
				}
				AND = {
					tier = BARON
					holder_scope = {
						liege = {
							character = FROM
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			FROM = {
				piety = -250
				set_secret_religion = saule
			}
		}
		#revoke_allowed = {
			#always = no
		#}

		ai_will_do = {
			factor = 0
		}
	}
	secretly_convert_to_saura_holy_site = {
		filter = owned
		ai_target_filter = self

		only_playable = yes

		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { secret_religion = saura }
			NOT = { religion = saura }
			NOT = { controls_religion = yes }
		}

		potential = {
			tier = COUNT
			NOT = {
				location = { religion = saura }
			}
			OR = {
				is_holy_site = saura
				any_de_jure_vassal_title = {
					is_holy_site = saura
											}
			}
			OR = {
				holder_scope = {
					character = FROM
				}
				AND = {
					tier = BARON
					holder_scope = {
						liege = {
							character = FROM
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			FROM = {
				piety = -250
				set_secret_religion = saura
			}
		}
		#revoke_allowed = {
			#always = no
		#}

		ai_will_do = {
			factor = 0
		}
	}
	secretly_convert_to_set_holy_site = {
		filter = owned
		ai_target_filter = self

		only_playable = yes

		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { secret_religion = set }
			NOT = { religion = set }
			NOT = { controls_religion = yes }
		}

		potential = {
			tier = COUNT
			NOT = {
				location = { religion = set }
			}
			OR = {
				is_holy_site = set
				any_de_jure_vassal_title = {
					is_holy_site = set
											}
			}
			OR = {
				holder_scope = {
					character = FROM
				}
				AND = {
					tier = BARON
					holder_scope = {
						liege = {
							character = FROM
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			FROM = {
				piety = -250
				set_secret_religion = set
			}
		}
		#revoke_allowed = {
			#always = no
		#}

		ai_will_do = {
			factor = 0
		}
	}
	secretly_convert_to_sol_christ_holy_site = {
		filter = owned
		ai_target_filter = self

		only_playable = yes

		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { secret_religion = sol_christ }
			NOT = { religion = sol_christ }
			NOT = { controls_religion = yes }
		}

		potential = {
			tier = COUNT
			NOT = {
				location = { religion = sol_christ }
			}
			OR = {
				is_holy_site = sol_christ
				any_de_jure_vassal_title = {
					is_holy_site = sol_christ
											}
			}
			OR = {
				holder_scope = {
					character = FROM
				}
				AND = {
					tier = BARON
					holder_scope = {
						liege = {
							character = FROM
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			FROM = {
				piety = -250
				set_secret_religion = sol_christ
			}
		}
		#revoke_allowed = {
			#always = no
		#}

		ai_will_do = {
			factor = 0
		}
	}
	secretly_convert_to_sufi_holy_site = {
		filter = owned
		ai_target_filter = self

		only_playable = yes

		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { secret_religion = sufi }
			NOT = { religion = sufi }
			NOT = { controls_religion = yes }
		}

		potential = {
			tier = COUNT
			NOT = {
				location = { religion = sufi }
			}
			OR = {
				is_holy_site = sufi
				any_de_jure_vassal_title = {
					is_holy_site = sufi
											}
			}
			OR = {
				holder_scope = {
					character = FROM
				}
				AND = {
					tier = BARON
					holder_scope = {
						liege = {
							character = FROM
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			FROM = {
				piety = -250
				set_secret_religion = sufi
			}
		}
		#revoke_allowed = {
			#always = no
		#}

		ai_will_do = {
			factor = 0
		}
	}
	secretly_convert_to_tengri_ahriman_holy_site = {
		filter = owned
		ai_target_filter = self

		only_playable = yes

		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { secret_religion = tengri_ahriman }
			NOT = { religion = tengri_ahriman }
			NOT = { controls_religion = yes }
		}

		potential = {
			tier = COUNT
			NOT = {
				location = { religion = tengri_ahriman }
			}
			OR = {
				is_holy_site = tengri_ahriman
				any_de_jure_vassal_title = {
					is_holy_site = tengri_ahriman
											}
			}
			OR = {
				holder_scope = {
					character = FROM
				}
				AND = {
					tier = BARON
					holder_scope = {
						liege = {
							character = FROM
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			FROM = {
				piety = -250
				set_secret_religion = tengri_ahriman
			}
		}
		#revoke_allowed = {
			#always = no
		#}

		ai_will_do = {
			factor = 0
		}
	}
	secretly_convert_to_vidharma_holy_site = {
		filter = owned
		ai_target_filter = self

		only_playable = yes

		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { secret_religion = vidharma }
			NOT = { religion = vidharma }
			NOT = { controls_religion = yes }
		}

		potential = {
			tier = COUNT
			NOT = {
				location = { religion = vidharma }
			}
			OR = {
				is_holy_site = vidharma
				any_de_jure_vassal_title = {
					is_holy_site = vidharma
											}
			}
			OR = {
				holder_scope = {
					character = FROM
				}
				AND = {
					tier = BARON
					holder_scope = {
						liege = {
							character = FROM
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			FROM = {
				piety = -250
				set_secret_religion = vidharma
			}
		}
		#revoke_allowed = {
			#always = no
		#}

		ai_will_do = {
			factor = 0
		}
	}
	secretly_convert_to_yahyanism_holy_site = {
		filter = owned
		ai_target_filter = self

		only_playable = yes

		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { secret_religion = yahyanism }
			NOT = { religion = yahyanism }
			NOT = { controls_religion = yes }
		}

		potential = {
			tier = COUNT
			NOT = {
				location = { religion = yahyanism }
			}
			OR = {
				is_holy_site = yahyanism
				any_de_jure_vassal_title = {
					is_holy_site = yahyanism
											}
			}
			OR = {
				holder_scope = {
					character = FROM
				}
				AND = {
					tier = BARON
					holder_scope = {
						liege = {
							character = FROM
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			FROM = {
				piety = -250
				set_secret_religion = yahyanism
			}
		}
		#revoke_allowed = {
			#always = no
		#}

		ai_will_do = {
			factor = 0
		}
	}
	secretly_convert_to_zor_angra_holy_site = {
		filter = owned
		ai_target_filter = self

		only_playable = yes

		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { secret_religion = zor_angra }
			NOT = { religion = zor_angra }
			NOT = { controls_religion = yes }
		}

		potential = {
			tier = COUNT
			NOT = {
				location = { religion = zor_angra }
			}
			OR = {
				is_holy_site = zor_angra
				any_de_jure_vassal_title = {
					is_holy_site = zor_angra
											}
			}
			OR = {
				holder_scope = {
					character = FROM
				}
				AND = {
					tier = BARON
					holder_scope = {
						liege = {
							character = FROM
						}
					}
				}
			}
		}

		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}

		effect = {
			FROM = {
				piety = -250
				set_secret_religion = zor_angra
			}
		}
		#revoke_allowed = {
			#always = no
		#}

		ai_will_do = {
			factor = 0
		}
	}
}

targeted_decisions = {
	secretly_convert_to_close_relations_religion = {
		#filter
		ai_target_filter = self
	
		only_playable = yes
		
		from_potential = {
			ai = no
			NOT = { trait = incapable }
			NOT = { controls_religion = yes }
		}
		
		potential = {
			OR = {
				AND = {
					spouse = {
						character = FROM
					}
					NOR = { 
						religion = FROM
						religion = { target_type = secret target = FROM }
					}
				}
				AND = {
					consort = {
						character = FROM
					}
					NOR = { 
						religion = FROM
						religion = { target_type = secret target = FROM }
					}
				}
				AND = {
					is_friend = FROM
					NOR = { 
						religion = FROM
						religion = { target_type = secret target = FROM }
					}
				}
			}
		}
		
		allow = {
			FROM = {
				piety = 250
				prisoner = no
				NOT = { trait = incapable }
				NOT = { is_inaccessible_trigger = yes }
				NOT = { society_member_of = secret_religious_cult }
			}
		}
		
		effect = {
			FROM = { set_secret_religion = { target_type = public target = PREV } }
			FROM = { piety = -250 }
		}
		
		#revoke_allowed = {
			#always = no
		#}
		
		ai_will_do = {
			factor = 0
		}
	}
}